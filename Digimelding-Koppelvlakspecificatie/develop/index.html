<!DOCTYPE html><html lang="nl"><head>
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta charset="utf-8">
<meta name="generator" content="ReSpec 28.1.0 Logius profile 20220113">
<style>
dfn{cursor:pointer}
.dfn-panel{position:absolute;z-index:35;min-width:300px;max-width:500px;padding:.5em .75em;margin-top:.6em;font:small Helvetica Neue,sans-serif,Droid Sans Fallback;background:#fff;color:#000;box-shadow:0 1em 3em -.4em rgba(0,0,0,.3),0 0 1px 1px rgba(0,0,0,.05);border-radius:2px}
.dfn-panel:not(.docked)>.caret{position:absolute;top:-9px}
.dfn-panel:not(.docked)>.caret::after,.dfn-panel:not(.docked)>.caret::before{content:"";position:absolute;border:10px solid transparent;border-top:0;border-bottom:10px solid #fff;top:0}
.dfn-panel:not(.docked)>.caret::before{border-bottom:9px solid #a2a9b1}
.dfn-panel *{margin:0}
.dfn-panel b{display:block;color:#000;margin-top:.25em}
.dfn-panel ul a[href]{color:#333}
.dfn-panel>div{display:flex}
.dfn-panel a.self-link{font-weight:700;margin-right:auto}
.dfn-panel .marker{padding:.1em;margin-left:.5em;border-radius:.2em;text-align:center;white-space:nowrap;font-size:90%;color:#040b1c}
.dfn-panel .marker.dfn-exported{background:#d1edfd;box-shadow:0 0 0 .125em #1ca5f940}
.dfn-panel .marker.idl-block{background:#8ccbf2;box-shadow:0 0 0 .125em #0670b161}
.dfn-panel a:not(:hover){text-decoration:none!important;border-bottom:none!important}
.dfn-panel a[href]:hover{border-bottom-width:1px}
.dfn-panel ul{padding:0}
.dfn-panel li{margin-left:1em}
.dfn-panel.docked{position:fixed;left:.5em;top:unset;bottom:2em;margin:0 auto;max-width:calc(100vw - .75em * 2 - .5em - .2em * 2);max-height:30vh;overflow:auto}
</style>
  
  
<meta content="text/html; charset=utf-8" http-equiv="content-type">
  
  
<title>Digimelding-koppelvlakspecificatie</title>
  
  
<link rel="shortcut icon" type="image/x-icon" href="https://publicatie.centrumvoorstandaarden.nl/respec/style/logos/logius.ico">
  
  
<link rel="stylesheet" type="text/css" href="./media/style.css">

<style id="respec-mainstyle">
@keyframes pop{
0%{transform:scale(1,1)}
25%{transform:scale(1.25,1.25);opacity:.75}
100%{transform:scale(1,1)}
}
:is(h1,h2,h3,h4,h5,h6,a) abbr{border:none}
dfn{font-weight:700}
a.internalDFN{color:inherit;border-bottom:1px solid #99c;text-decoration:none}
a.externalDFN{color:inherit;border-bottom:1px dotted #ccc;text-decoration:none}
a.bibref{text-decoration:none}
.respec-offending-element:target{animation:pop .25s ease-in-out 0s 1}
.respec-offending-element,a[href].respec-offending-element{text-decoration:red wavy underline}
@supports not (text-decoration:red wavy underline){
.respec-offending-element:not(pre){display:inline-block}
.respec-offending-element{background:url(data:image/gif;base64,R0lGODdhBAADAPEAANv///8AAP///wAAACwAAAAABAADAEACBZQjmIAFADs=) bottom repeat-x}
}
#references :target{background:#eaf3ff;animation:pop .4s ease-in-out 0s 1}
cite .bibref{font-style:normal}
code{color:#c63501}
th code{color:inherit}
a[href].orcid{padding-left:4px;padding-right:4px}
a[href].orcid>svg{margin-bottom:-2px}
.toc a,.tof a{text-decoration:none}
a .figno,a .secno{color:#000}
ol.tof,ul.tof{list-style:none outside none}
.caption{margin-top:.5em;font-style:italic}
table.simple{border-spacing:0;border-collapse:collapse;border-bottom:3px solid #005a9c}
.simple th{background:#005a9c;color:#fff;padding:3px 5px;text-align:left}
.simple th a{color:#fff;padding:3px 5px;text-align:left}
.simple th[scope=row]{background:inherit;color:inherit;border-top:1px solid #ddd}
.simple td{padding:3px 10px;border-top:1px solid #ddd}
.simple tr:nth-child(even){background:#f0f6ff}
.section dd>p:first-child{margin-top:0}
.section dd>p:last-child{margin-bottom:0}
.section dd{margin-bottom:1em}
.section dl.attrs dd,.section dl.eldef dd{margin-bottom:0}
#issue-summary>ul{column-count:2}
#issue-summary li{list-style:none;display:inline-block}
details.respec-tests-details{margin-left:1em;display:inline-block;vertical-align:top}
details.respec-tests-details>*{padding-right:2em}
details.respec-tests-details[open]{z-index:999999;position:absolute;border:thin solid #cad3e2;border-radius:.3em;background-color:#fff;padding-bottom:.5em}
details.respec-tests-details[open]>summary{border-bottom:thin solid #cad3e2;padding-left:1em;margin-bottom:1em;line-height:2em}
details.respec-tests-details>ul{width:100%;margin-top:-.3em}
details.respec-tests-details>li{padding-left:1em}
a[href].self-link:hover{opacity:1;text-decoration:none;background-color:transparent}
h2,h3,h4,h5,h6{position:relative}
aside.example .marker>a.self-link{color:inherit}
:is(h2,h3,h4,h5,h6)>a.self-link{border:none;color:inherit;font-size:83%;height:2em;left:-1.6em;opacity:.5;position:absolute;text-align:center;text-decoration:none;top:0;transition:opacity .2s;width:2em}
:is(h2,h3,h4,h5,h6)>a.self-link::before{content:"§";display:block}
@media (max-width:767px){
dd{margin-left:0}
:is(h2,h3,h4,h5,h6)>a.self-link{left:auto;top:auto}
}
@media print{
.removeOnSave{display:none}
}
</style>
<meta name="description" content="">
<style>
var{position:relative;cursor:pointer}
var[data-type]::after,var[data-type]::before{position:absolute;left:50%;top:-6px;opacity:0;transition:opacity .4s;pointer-events:none}
var[data-type]::before{content:"";transform:translateX(-50%);border-width:4px 6px 0 6px;border-style:solid;border-color:transparent;border-top-color:#000}
var[data-type]::after{content:attr(data-type);transform:translateX(-50%) translateY(-100%);background:#000;text-align:center;font-family:"Dank Mono","Fira Code",monospace;font-style:normal;padding:6px;border-radius:3px;color:#daca88;text-indent:0;font-weight:400}
var[data-type]:hover::after,var[data-type]:hover::before{opacity:1}
</style>
<script id="initialUserConfig" type="application/json">{
  "specStatus": "WV",
  "specType": "HR",
  "subtitle": "Handreiking",
  "shortName": "digimelding-koppelvlak",
  "publishDate": "2021-02-19",
  "previousPublishDate": "2021-01-31",
  "license": "cc-by-nd",
  "doJsonLd": true,
  "editors": [
    {
      "name": "Edwin Wisse",
      "url": "https://logius.nl/standaarden",
      "company": "Logius"
    },
    {
      "name": "Peter Haasnoot",
      "url": "https://logius.nl/standaarden",
      "company": "Logius"
    }
  ],
  "authors": [
    {
      "name": "Logius",
      "url": "mailto:digikoppeling@logius.nl",
      "mailto": "digikoppeling@logius.nl"
    }
  ],
  "github": "https://github.com/Logius-standaarden/Digimelding-Koppelvlakspecificatie",
  "addSectionLinks": true,
  "a11y": false,
  "alternateFormats": [
    {
      "label": "pdf",
      "uri": "Digimelding-Koppelvlakspecificatie.pdf"
    }
  ],
  "pubDomain": "dk",
  "nl_addReleaseTagTitle": false,
  "nl_emailComments": "digikoppeling@logius.nl",
  "nl_github": {
    "revision": "https://github.com/Logius-standaarden/Digimelding-Koppelvlakspecificatie/commits/"
  },
  "nl_organisationName": "Logius",
  "nl_organisationPrefix": "LS-",
  "nl_markdownTableClass": "simple",
  "nl_markdownEmbedImageInFigure": true,
  "nl_organisationStylesURL": "https://publicatie.centrumvoorstandaarden.nl/respec/style/",
  "nl_organisationPublishURL": "https://publicatie.centrumvoorstandaarden.nl/",
  "nl_logo": {
    "src": "https://publicatie.centrumvoorstandaarden.nl/respec/style/logos/figure-logius.svg",
    "alt": "Logius",
    "id": "Logius",
    "height": 77,
    "width": 44,
    "url": "https://www.logius.nl/standaarden"
  },
  "localBiblio": {
    "NEN3610": {
      "href": "https://www.nen.nl/nen-3610-2011-a1-2016-nl-217738",
      "title": "Basismodel Geo-informatie - Termen, definities, relaties en algemene regels voor de uitwisseling van informatie over aan de aarde gerelateerde ruimtelijke objecten",
      "authors": [
        ""
      ],
      "date": "Maart 2011",
      "publisher": "Nederlands Normalisatie-instituut"
    },
    "Digikoppeling Architectuur": {
      "href": "https://centrumvoorstandaarden.github.io/Architectuur2.0-metRestfulAPI/static.html",
      "title": "Digikoppeling Architectuur",
      "authors": [
        "Logius Centrum voor standaarden"
      ],
      "date": "december 2020",
      "publisher": "Logius"
    },
    "Digikoppeling-Cert": {
      "href": "http://www.logius.nl/digikoppeling",
      "title": "Gebruik en achtergrond van Digikoppeling certificaten",
      "publisher": "Logius"
    },
    "PKI Policy": {
      "href": "https://www.logius.nl/diensten/pkioverheid/aansluiten-als-tsp/pogramma-van-eisen",
      "title": "Programma van Eisen (PKIoverheid)",
      "publisher": "Logius"
    },
    "PKI CA": {
      "href": "https://www.logius.nl/diensten/pkioverheid/aansluiten-als-tsp/toegetreden-vertrouwensdienstverleners",
      "title": "Toegetreden vertrouwensdienstverleners",
      "publisher": "Logius"
    },
    "PKIoverheid Certificaten": {
      "href": "https://cert.pkioverheid.nl/",
      "title": "Pkioverheid certificaten",
      "publisher": "Logius"
    },
    "Logius website": {
      "href": "https://logius.nl/digikoppeling",
      "title": "Logius Digikoppeling",
      "publisher": "Logius"
    },
    "Digikoppeling Compliance Voorziening": {
      "href": "https://portaal.digikoppeling.nl",
      "title": "Digikoppeling Compliance Voorziening",
      "publisher": "Logius"
    },
    "API Design Rules": {
      "href": "https://publicatie.centrumvoorstandaarden.nl/api/adr/",
      "title": "API Design Rules (Nederlandse API Strategie IIa)",
      "authors": [
        "Jasper Roes",
        "Joost Farla"
      ],
      "date": "Juli 2020",
      "publisher": "Logius"
    },
    "Digikoppeling Koppelvlakstandaard REST API": {
      "href": "https://centrumvoorstandaarden.github.io/DigikoppelingRestfulApiProfiel/",
      "title": "Digikoppeling Restful API Profiel (Concept)",
      "date": "februari 2021",
      "publisher": "Logius"
    },
    "Digikoppeling Beheermodel": {
      "href": "https://www.logius.nl/sites/default/files/public/bestanden/diensten/DigiKoppeling/Standaarden/Digikoppeling-Beheermodel.pdf",
      "title": "Beheermodel en releasebeleid Digikoppeling v1.5",
      "date": "Oktober 2017",
      "publisher": "Logius"
    },
    "Digikoppeling Koppelvlakstandaard Grote Berichten": {
      "href": "https://logius-standaarden.github.io/Digikoppeling-Koppelvlakstandaard-GB/",
      "title": "Digikoppeling Koppelvlakstandaard Grote Berichten",
      "date": "september 2020",
      "publisher": "Logius"
    },
    "Digikoppeling Koppelvlakstandaard WUS": {
      "href": "https://logius-standaarden.github.io/Digikoppeling-Koppelvlakstandaard-WUS/",
      "title": "Digikoppeling Koppelvlakstandaard ebMS2",
      "date": "oktober 2020",
      "publisher": "Logius"
    },
    "Digikoppeling Koppelvlakstandaard ebMS2": {
      "href": "https://logius-standaarden.github.io/Digikoppeling-Koppelvlakstandaard-ebMS2/",
      "title": "Digikoppeling Koppelvlakstandaard ebMS2",
      "date": "mei 2019",
      "publisher": "Logius"
    },
    "Digikoppeling Beveiligingsdocument": {
      "href": "https://www.logius.nl/sites/default/files/bestanden/website/Digikoppeling_Beveiligingsstandaarden_en_voorschriften_v1.3.pdf",
      "title": "Digikoppeling Beveiligingsstandaarden en voorschriften",
      "date": "2020",
      "publisher": "Logius"
    },
    "Digikoppeling Best Practices ebMS2": {
      "href": "https://www.logius.nl/diensten/digikoppeling/documentatie",
      "title": "Digikoppeling Best Practices ebMS2",
      "date": "2019",
      "publisher": "Logius"
    },
    "Digikoppeling Best Practices WUS": {
      "href": "https://www.logius.nl/diensten/digikoppeling/documentatie",
      "title": "Digikoppeling Best Practices WUS",
      "date": "2019",
      "publisher": "Logius"
    },
    "Digikoppeling Best Practices Grote Berichten": {
      "href": "https://www.logius.nl/diensten/digikoppeling/documentatie",
      "title": "Digikoppeling Best Practices Grote Berichten",
      "date": "2019",
      "publisher": "Logius"
    },
    "Digikoppeling Identificatie-Authenticatie": {
      "href": "https://www.logius.nl/diensten/digikoppeling/documentatie",
      "title": "Digikoppeling Identificatie en Authenticatie",
      "publisher": "Logius"
    },
    "Digikoppeling Actuele Documentatie": {
      "href": "http://www.logius.nl/digikoppeling",
      "title": "Digikoppeling Overzicht Actuele Documentatie en Compliance",
      "publisher": "Logius"
    },
    "Digikoppeling Gebruik Certificaten": {
      "href": "http://www.logius.nl/digikoppeling",
      "title": "Digikoppeling Gebruik en achtergrond certificaten",
      "publisher": "Logius"
    },
    "Pas-toe-of-leg-uit": {
      "href": "https://www.forumstandaardisatie.nl/open-standaarden/verplicht",
      "title": "Lijst Verplichte standaarden",
      "publisher": "Forum Standaardisatie"
    }
  },
  "publishISODate": "2021-02-19T00:00:00.000Z",
  "generatedSubtitle": "Werkversie 04 april 2022"
}</script>
<link rel="stylesheet" href="https://publicatie.centrumvoorstandaarden.nl/respec/style/LS-WV.css"></head>

<body class="h-entry toc-inline"><div class="head">
    <a class="logo" href="https://www.logius.nl/standaarden"><img alt="Logius" height="77" id="Logius" src="https://publicatie.centrumvoorstandaarden.nl/respec/style/logos/figure-logius.svg" width="44">
  </a> <h1 id="title" class="title">Digimelding-koppelvlakspecificatie</h1>
    <h2 id="subtitle" class="subtitle">Handreiking</h2>
    <h2>
      Logius Handreiking<br>
      Werkversie
      <time class="dt-published" datetime="2021-02-19">04 april 2022</time>
    </h2>
	<a lang="nl" href="https://publicatie.centrumvoorstandaarden.nl/">Overzicht standaarden</a>
    <dl>
      <dt>Deze versie:</dt><dd class="status">
              <a class="u-url status" href="https://logius-standaarden.github.io/Digimelding-Koppelvlakspecificatie/">https://logius-standaarden.github.io/Digimelding-Koppelvlakspecificatie/</a>
            </dd><dt>Laatst gepubliceerde versie:</dt><dd>
              <a href="https://publicatie.centrumvoorstandaarden.nl/dk/digimelding-koppelvlak/">https://publicatie.centrumvoorstandaarden.nl/dk/digimelding-koppelvlak/</a>
            </dd>
      <dt>Laatste werkversie:</dt><dd><a href="https://logius-standaarden.github.io/Digimelding-Koppelvlakspecificatie/">https://logius-standaarden.github.io/Digimelding-Koppelvlakspecificatie/</a></dd>
      
      
      
      <dt>Vorige versie</dt><dd><a href="https://publicatie.centrumvoorstandaarden.nl/dk/digimelding-koppelvlak/wv-hr-digimelding-koppelvlak-20210131/">https://publicatie.centrumvoorstandaarden.nl/dk/digimelding-koppelvlak/wv-hr-digimelding-koppelvlak-20210131/</a></dd>
      
      <dt>Redacteurs:</dt>
      <dd class="editor p-author h-card vcard">
    <a class="u-url url p-name fn" href="https://logius.nl/standaarden">Edwin Wisse</a> (<span class="p-org org h-org">Logius</span>)
  </dd><dd class="editor p-author h-card vcard">
    <a class="u-url url p-name fn" href="https://logius.nl/standaarden">Peter Haasnoot</a> (<span class="p-org org h-org">Logius</span>)
  </dd>
      
      <dt>Auteur:</dt><dd class="editor p-author h-card vcard">
    <a class="ed_mailto u-email email p-name" href="mailto:digikoppeling@logius.nl">Logius</a>
  </dd>
      <dt>Doe mee:</dt><dd>
    <a href="https://github.com/Logius-standaarden/Digimelding-Koppelvlakspecificatie/">GitHub Logius-standaarden/Digimelding-Koppelvlakspecificatie</a>
  </dd><dd>
    <a href="https://github.com/Logius-standaarden/Digimelding-Koppelvlakspecificatie/issues/">Dien een melding in</a>
  </dd><dd>
    <a href="https://github.com/Logius-standaarden/Digimelding-Koppelvlakspecificatie/commits/">Revisiehistorie</a>
  </dd><dd>
    <a href="https://github.com/Logius-standaarden/Digimelding-Koppelvlakspecificatie/pulls/">Pull requests</a>
  </dd>
    </dl>
    
    
    <p lang="en">
          This document is also available in this non-normative format:
          <a rel="alternate" href="Digimelding-Koppelvlakspecificatie.pdf">pdf</a>
        </p>
    <p class="copyright" lang="en">
          This document is licensed under a
          <a rel="license" href="https://creativecommons.org/licenses/by/4.0/" class="subfoot">Creative Commons Attribution 4.0 License</a>.
        </p>
    <hr title="Separator for header">
  </div>

  <section id="abstract" class="introductory"><h2 id="samenvatting">Samenvatting<a class="self-link" href="#abstract" aria-label="Permalink for Section"></a></h2><p></p></section>
  <section id="sotd" class="introductory"><h2 id="status-van-dit-document">Status van dit document<a class="self-link" href="#sotd" aria-label="Permalink for Section"></a></h2>Dit is een werkversie die op elk moment kan worden gewijzigd, verwijderd of vervangen door andere documenten. Het is geen door het Technisch Overleg goedgekeurde consultatieversie.<p></p></section><nav id="toc"><h2 class="introductory" id="inhoudsopgave">Inhoudsopgave</h2><ol class="toc"><li class="tocline"><a class="tocxref" href="#abstract">Samenvatting</a></li><li class="tocline"><a class="tocxref" href="#sotd">Status van dit document</a></li><li class="tocline"><a class="tocxref" href="#conformance"><bdi class="secno">1. </bdi>Conformiteit</a></li><li class="tocline"><a class="tocxref" href="#inleiding"><bdi class="secno">2. </bdi>Inleiding</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#achtergrond"><bdi class="secno">2.1 </bdi>Achtergrond</a></li><li class="tocline"><a class="tocxref" href="#bronverwijzing-en-referentiedocumenten"><bdi class="secno">2.2 </bdi>Bronverwijzing en referentiedocumenten</a></li></ol></li><li class="tocline"><a class="tocxref" href="#functionaliteit-op-hoofdlijnen-en-architectuur"><bdi class="secno">3. </bdi>Functionaliteit op hoofdlijnen en architectuur</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#referentiearchitectuur"><bdi class="secno">3.1 </bdi>Referentiearchitectuur</a></li></ol></li><li class="tocline"><a class="tocxref" href="#beveiliging-autorisatie-en-protocollen"><bdi class="secno">4. </bdi>Beveiliging, autorisatie en protocollen</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#authenticatie-en-autorisatie"><bdi class="secno">4.1 </bdi>Authenticatie en autorisatie</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#protocollen"><bdi class="secno">4.1.1 </bdi>Protocollen</a></li></ol></li></ol></li><li class="tocline"><a class="tocxref" href="#specificaties-services"><bdi class="secno">5. </bdi>Specificaties Services</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#annotaties-algemeen"><bdi class="secno">5.1 </bdi>Annotaties Algemeen</a></li><li class="tocline"><a class="tocxref" href="#annotatie-versturen"><bdi class="secno">5.2 </bdi>Annotatie versturen</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#algemeen"><bdi class="secno">5.2.1 </bdi>Algemeen</a></li><li class="tocline"><a class="tocxref" href="#scenario-s-communicatie"><bdi class="secno">5.2.2 </bdi>Scenario's Communicatie</a></li><li class="tocline"><a class="tocxref" href="#inhoud-bericht-annotatie-toevoegenrequest"><bdi class="secno">5.2.3 </bdi>Inhoud bericht Annotatie ToevoegenRequest</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#annotatie-toevoegen-terugmelden"><bdi class="secno">5.2.3.1 </bdi>Annotatie toevoegen (terugmelden)</a></li><li class="tocline"><a class="tocxref" href="#annotatie-toevoegen-intrekken"><bdi class="secno">5.2.3.2 </bdi>Annotatie toevoegen (intrekken)</a></li><li class="tocline"><a class="tocxref" href="#annotatie-toevoegen-aanpassing"><bdi class="secno">5.2.3.3 </bdi>Annotatie toevoegen (aanpassing)</a></li></ol></li></ol></li><li class="tocline"><a class="tocxref" href="#status-bevragen"><bdi class="secno">5.3 </bdi>Status bevragen</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#algemeen-0"><bdi class="secno">5.3.1 </bdi>Algemeen</a></li><li class="tocline"><a class="tocxref" href="#statusoverzichtrequest"><bdi class="secno">5.3.2 </bdi>StatusoverzichtRequest</a></li><li class="tocline"><a class="tocxref" href="#statusoverzichtresponse"><bdi class="secno">5.3.3 </bdi>StatusoverzichtResponse</a></li><li class="tocline"><a class="tocxref" href="#detailsterugmeldingrequest"><bdi class="secno">5.3.4 </bdi>DetailsTerugmeldingRequest</a></li><li class="tocline"><a class="tocxref" href="#detailsterugmeldingresponse"><bdi class="secno">5.3.5 </bdi>DetailsTerugmeldingResponse</a></li></ol></li><li class="tocline"><a class="tocxref" href="#echo"><bdi class="secno">5.4 </bdi>Echo</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#algemeen-1"><bdi class="secno">5.4.1 </bdi>Algemeen</a></li><li class="tocline"><a class="tocxref" href="#echorequest"><bdi class="secno">5.4.2 </bdi>EchoRequest</a></li><li class="tocline"><a class="tocxref" href="#echoresponse"><bdi class="secno">5.4.3 </bdi>EchoResponse</a></li></ol></li></ol></li><li class="tocline"><a class="tocxref" href="#foutberichten"><bdi class="secno">6. </bdi>Foutberichten</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#autorisatiefouten"><bdi class="secno">6.1 </bdi>Autorisatiefouten</a></li><li class="tocline"><a class="tocxref" href="#verwerkingsfouten"><bdi class="secno">6.2 </bdi>Verwerkingsfouten</a></li><li class="tocline"><a class="tocxref" href="#syntaxfouten"><bdi class="secno">6.3 </bdi>Syntaxfouten</a></li><li class="tocline"><a class="tocxref" href="#generieke-foutcodes-van-toepassing-op-digimelding"><bdi class="secno">6.4 </bdi>Generieke foutcodes van toepassing op Digimelding</a></li></ol></li><li class="tocline"><a class="tocxref" href="#bijlagen"><bdi class="secno">7. </bdi>bijlagen</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#bijlage-a-afkortingen-begrippen-en-symbolen-bijlage-a-afkortingen-begrippen-en-symbolen-list-paragraph"><bdi class="secno">7.1 </bdi>Bijlage A: Afkortingen, begrippen en symbolen {#bijlage-a-afkortingen-begrippen-en-symbolen .list-paragraph}</a></li><li class="tocline"><a class="tocxref" href="#bijlage-b-geadviseerde-statussen-bijlage-b-geadviseerde-statussen-list-paragraph"><bdi class="secno">7.2 </bdi>Bijlage B : Geadviseerde Statussen {#bijlage-b-geadviseerde-statussen .list-paragraph}</a></li></ol></li></ol></nav>
  
  <section id="conformance"><h2 id="x1-conformiteit"><bdi class="secno">1. </bdi>Conformiteit<a class="self-link" href="#conformance" aria-label="Permalink for Section 1."></a></h2><p>Naast onderdelen die als niet normatief gemarkeerd zijn, zijn ook alle diagrammen, voorbeelden, en noten in dit document niet normatief. Verder is alles in dit document normatief.</p></section>

  <section class="introductory" data-format="markdown"><h1>Documentbeheer</h1><table class="simple">
<thead>
<tr>
<th>Datum</th>
<th>Versie</th>
<th>Auteur</th>
<th>Opmerkingen</th>
</tr>
</thead>
<tbody><tr>
<td>13-02-2015</td>
<td>0.1</td>
<td>Logius</td>
<td>Eerste concept</td>
</tr>
<tr>
<td></td>
<td>0.2</td>
<td></td>
<td></td>
</tr>
<tr>
<td>28-10-2015</td>
<td>0.9</td>
<td>Logius</td>
<td>Diverse spellingsverbeteringen.</td>
</tr>
<tr>
<td>31-03-2016</td>
<td>0.91</td>
<td>Logius</td>
<td>Aanpassingen n.a.v. bevindingen pilot</td>
</tr>
<tr>
<td>30-03-2016</td>
<td>1.0</td>
<td>Logius</td>
<td>Definitief na goedkeuring Afnemersraad</td>
</tr>
<tr>
<td>14-05-2018</td>
<td>1.1</td>
<td>Logius</td>
<td>RFC Behandelend Bronhouder</td>
</tr>
<tr>
<td>21-11-2019</td>
<td>1.2</td>
<td>Logius</td>
<td>Zie release notes</td>
</tr>
<tr>
<td>24-06-2020</td>
<td>1.2.1</td>
<td>Logius</td>
<td>Tekstuele aanpassingen / correcties</td>
</tr>
<tr>
<td>01-06-2021</td>
<td>1.3</td>
<td>Logius</td>
<td>RFC-2020-3 - SSOn-Rijk gebruik in Digimelding Portaal</td>
</tr>
</tbody></table></section>
  <section class="introductory" data-format="markdown"><h1>Colofon</h1><table class="simple">
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>Logius Servicecentrum:</td>
<td>Postbus 96810 <br>2509 JE Den Haag<br>tel. 0900 555 4555 (10 ct p/m)<br>email <a href="mailto:servicecentrum@logius.nl">servicecentrum@logius.nl</a></td>
</tr>
</tbody></table></section>

  <section data-format="markdown" id="inleiding"><h2 id="x2-inleiding"><bdi class="secno">2. </bdi>Inleiding<a class="self-link" href="#inleiding" aria-label="Permalink for Section 2."></a></h2><section id="achtergrond"><h3 id="x2-1-achtergrond"><bdi class="secno">2.1 </bdi>Achtergrond<a class="self-link" href="#achtergrond" aria-label="Permalink for Section 2.1"></a></h3><p>Voor terugmeldvoorzieningen in het algemeen is de Digimelding
Koppelvlakspecificatie (DMKS) opgesteld, waarin wordt
gespecificeerd hoe terugmeldingen verzonden dienen te worden. De
webservices waarmee gemeentelijke pakketleveranciers geautomatiseerde
terugmeldingen kunnen doen zijn ook gebaseerd op Digimelding.</p><p>De volgende partijen hebben meegewerkt aan de totstandkoming van dit
document: Gemeente Amsterdam, Centric, Gemeente Den Haag, Gemeente
Rotterdam, ICTU, Kamer van Koophandel, KING, Logius, PinkRoccade, Vicrea
en de Waarderingskamer.</p></section><section id="bronverwijzing-en-referentiedocumenten"><h3 id="x2-2-bronverwijzing-en-referentiedocumenten"><bdi class="secno">2.2 </bdi>Bronverwijzing en referentiedocumenten<a class="self-link" href="#bronverwijzing-en-referentiedocumenten" aria-label="Permalink for Section 2.2"></a></h3><table class="simple">
<thead>
<tr>
<th>Referentiedocument</th>
<th>Bronverwijzing</th>
</tr>
</thead>
<tbody><tr>
<td>GEMMA Informatiearchitectuur 1.0</td>
<td><a href="http://www.noraonline.nl/images/noraonline/a/a3/GEMMA_Informatiearchitectuur_v10_KING.pdf">PDF versie op NORA</a></td>
</tr>
<tr>
<td>StUF 3.01</td>
<td><a href="http://www.gemmaonline.nl/index.php/StUF_Berichtenstandaard">StUF website</a></td>
</tr>
<tr>
<td>StUF protocolbindingen 3.02</td>
<td><a href="http://www.gemmaonline.nl/index.php/StUF_Berichtenstandaard">StUF website</a></td>
</tr>
<tr>
<td>ArchiMate 2.n</td>
<td><a href="https://www.opengroup.org/">The Open Group Website</a></td>
</tr>
<tr>
<td>DMKS cookiebox</td>
<td><a href="https://www.logius.nl/diensten/digimelding/">Digimelding pagina op Logius website</a></td>
</tr>
<tr>
<td>Digikoppeling WUS 3.0</td>
<td><a href="https://publicatie.centrumvoorstandaarden.nl/dk/wus/">Vastgestelde versie 06 oktober 2020</a></td>
</tr>
<tr>
<td>Digikoppeling-architectuur</td>
<td><a href="https://publicatie.centrumvoorstandaarden.nl/dk/architectuur/">Vastgestelde versie 07 oktober 2018</a></td>
</tr>
</tbody></table></section></section>
  <section data-format="markdown" id="functionaliteit-op-hoofdlijnen-en-architectuur"><h2 id="x3-functionaliteit-op-hoofdlijnen-en-architectuur"><bdi class="secno">3. </bdi>Functionaliteit op hoofdlijnen en architectuur<a class="self-link" href="#functionaliteit-op-hoofdlijnen-en-architectuur" aria-label="Permalink for Section 3."></a></h2><p>Deze specificatie geeft een technische en functionele beschrijving van
een aantal services voor het uitwisselen van informatie tussen
terugmeldapplicaties, Digimelding Webservice en landelijke voorzieningen
van basisregistraties</p><p>De beschreven services zorgen ervoor dat de informatie op een standaard
manier wordt uitgewisseld.</p><p>In de volgende paragraaf wordt ingegaan op hoe de services zich
verhouden tot de NORA-informatiearchitectuur en welke standaarden worden
gebruikt. Vervolgens wordt dieper ingegaan op de functionaliteit die
deze services moeten bieden.</p><section id="referentiearchitectuur"><h3 id="x3-1-referentiearchitectuur"><bdi class="secno">3.1 </bdi>Referentiearchitectuur<a class="self-link" href="#referentiearchitectuur" aria-label="Permalink for Section 3.1"></a></h3><p>In deze specificatie wordt uitgegaan van een referentiearchitectuur.</p><p><figure id="fig-de-referentiearchitectuur"><img src="images/image1.png" alt="De referentiearchitectuur" title="De referentiearchitectuur"><figcaption>Figuur <bdi class="figno">1</bdi> <span class="fig-title">De referentiearchitectuur</span></figcaption></figure>{width="5.986629483814523in"
height="3.164179790026247in"}</p><p>In <a href="#fig-de-referentiearchitectuur">bovenstaande figuur</a> is de referentie-applicatiearchitectuur weergegeven. Deze
gaat uit van een generiek overheidsperspectief, waarbij wordt
teruggemeld op meerdere basisregistraties en het dus handig is om
gebruik te maken van de routering door Digimelding Webservice. Het is
ook mogelijk om als afnemer direct aan te sluiten op de TMV van een
basisregistratie. De specificaties van de services in hoofdstuk 6 laten
beide varianten toe.</p><p>Aangaande deze catalogusvoorziening kunnen de verschillende catalogi ook
als bestanden beschikbaar gesteld worden aan de terugmeldende
organisaties voor implementaties in de eigen terugmeldapplicatie.</p><p>Aan deze specificatie wordt voldaan indien de in hoofdstuk 4 beschreven
services, voor zover deze relevant zijn voor de betreffende applicatie,
worden ondersteund.</p><p>Aanvullend geldt dat er een aantal implementatievarianten zijn.</p><table class="simple">
<thead>
<tr>
<th align="left">Implementatievariant</th>
<th align="left">Specifieke en aanvullende eisen</th>
</tr>
</thead>
<tbody><tr>
<td align="left">A1</td>
<td align="left">De terugmeldende ambtenaar maakt gebruik van het landelijke Digimelding Webservice portaal.</td>
</tr>
<tr>
<td align="left">A2</td>
<td align="left">De terugmeldende ambtenaar maakt gebruik van een lokaal binnen de organisatie geïnstalleerd terugmeldportaal welke middels webservices communiceert.</td>
</tr>
<tr>
<td align="left">A3</td>
<td align="left">De terugmeldende ambtenaar maakt gebruik van een terugmeldoptie binnen zijn taakapplicatie; de taakapplicatie zet deze terugmelding door naar een terugmeldapplicatie binnen de organisatie welke middels webservices communiceert.</td>
</tr>
<tr>
<td align="left">B1</td>
<td align="left">De communicatie middels webservices tussen terugmeldende organisatie en landelijke voorziening van een basisregistratie loopt via een webservices koppelvlak op de Digimelding Webservice, als landelijke voorziening. Deze landelijke voorziening verzorgt routering naar basisregistraties (en mogelijk protocoltransformatie naar een vorige of volgende versie van het koppelvlak).</td>
</tr>
<tr>
<td align="left">B2</td>
<td align="left">De communicatie middels webservices tussen terugmeldende organisatie en landelijke voorziening van een basisregistratie loopt rechtstreeks (staat niet geïllustreerd in referentieplaatje hierboven).</td>
</tr>
</tbody></table></section></section>
  <section data-format="markdown" id="beveiliging-autorisatie-en-protocollen"><h2 id="x4-beveiliging-autorisatie-en-protocollen"><bdi class="secno">4. </bdi>Beveiliging, autorisatie en protocollen<a class="self-link" href="#beveiliging-autorisatie-en-protocollen" aria-label="Permalink for Section 4."></a></h2><section id="authenticatie-en-autorisatie"><h3 id="x4-1-authenticatie-en-autorisatie"><bdi class="secno">4.1 </bdi>Authenticatie en autorisatie<a class="self-link" href="#authenticatie-en-autorisatie" aria-label="Permalink for Section 4.1"></a></h3><p>Binnen de Digimelding-keten vindt op meerdere plaatsen authenticatie en
autorisatie plaats.</p><p>In deze sectie wordt uitgelegd welke verschillende middelen er zijn en
in welke stap ze gebruikt worden. Binnen Digimelding vinden
authenticatie en autorisatie plaats op transportniveau, applicatieniveau
en soms op persoonsniveau. Transport en logistiek gaan via de
Digikoppeling-standaarden.</p><p>Op applicatieniveau gaat het over de terugmeldapplicatie van de afnemer,
Digimelding Webservice en TMVs van basisregistraties.</p><p>Persoonsniveau komt voor bij Digimelding Portaal en mogelijkerwijs bij
nog te ontwikkelen andere oplossingen die gebruik maken van eHerkenning
of SSOn Rijk. Daarnaast kent een afnemende organisatie ook nog interne
authenticatie en autorisatie voor het verkrijgen van toegang door de
terugmelder tot de terugmeldapplicatie. Dit is buiten scope van deze
specificatie.</p><p><figure id="fig-authenticatie-en-autorisatie-bij-digimelding"><img src="images/image2.png" alt="Authenticatie en autorisatie bij Digimelding" title="Authenticatie en autorisatie bij Digimelding"><figcaption>Figuur <bdi class="figno">2</bdi> <span class="fig-title">Authenticatie en autorisatie bij Digimelding</span></figcaption></figure></p><table class="simple">
<thead>
<tr>
<th align="left"><strong>Autorisatie</strong></th>
<th align="left"></th>
<th align="left"></th>
<th align="left"></th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>Terugmelder</strong></td>
<td align="left"><strong>Terugmeld Applicatie</strong></td>
<td align="left"><strong>Digikoppeling Adapter</strong></td>
<td align="left"><strong>TMV Basisregistratie</strong></td>
</tr>
<tr>
<td align="left">E-herkenning in DMKS bericht<br>OIN<br>Vestigingsnr<br>Persoonsaanduiding</td>
<td align="left">OIN in DMKS bericht</td>
<td align="left">OIN in Digikoppeling Headers WS-Adressing</td>
<td align="left">Transport via Digikoppeling</td>
</tr>
<tr>
<td align="left">SSOn Rijk<br>OIN<br>Vestigingsnr<br>Persoonsaanduiding</td>
<td align="left">(PKIO certificaat met OIN voor signing)</td>
<td align="left">PKIO certificaat met OIN voor TLS/signing</td>
<td align="left">Applicatie: via OIN in DMKS bericht of via E-Herkenning : OIN, vestigingsnummer en persoonsaanduiding in DMKS bericht of via SSOn Rijk attributen</td>
</tr>
<tr>
<td align="left">Vrije keuze</td>
<td align="left">OIN in Digikoppeling Header WS-security</td>
<td align="left"></td>
<td align="left"></td>
</tr>
</tbody></table><p>Figuur 2. Authenticatie en autorisatie bij Digimelding</p><p>Indien in de keten de terugmelder met eHerkenning geauthenticeerd wordt,
willen basisregistraties dit altijd gebruiken als autorisatiemiddel en
dienen de eHerkenningsgegevens ( 'OIN'[^1], 'vestigingsnummer' en
'pseudoID' van de natuurlijk persoon(ontvangen via een SAML-token) in
het DMKS-bericht doorgegeven te worden. In deze gevallen is de
autorisatie voor de TMV-applicatie geregeld middels eHerkenning op
persoonsniveau.</p><p>[^1]: De eHerkenningmiddelenleverancier stuurt een SAML token terug met daarin
o.a. het 'OIN' zoals in de eHerkenningskoppelvlakstandaard is
gespecificeerd. Dit 'OIN' met een prefix 00000003 is niet gelijk aan
het door Logius uitgegeven OIN zoals in het OIN-register is
opgenomen.</p><p>Indien in de keten de terugmelder met SSOn-Rijk geauthenticeerd wordt,
willen basisregistraties dit altijd gebruiken als autorisatiemiddel en
dienen de gegevens ('OIN', en 'pseudoID' ) van de natuurlijk persoon
(ontvangen via een SAML-token) in het DMKS-bericht doorgegeven te
worden. In deze gevallen is de autorisatie voor de TMV-applicatie
geregeld middels SSOn-Rijk op persoonsniveau.</p><p>In het geval dat er geen authenticatie op Persoonssniveau plaatsvindt,
worden authenticatie en autorisatie op applicatieniveau gedaan op basis
van het OIN van de afnemende organisatie. Dit is het OIN dat een
organisatie krijgt wanneer deze zich aanmeldt voor Digikoppeling en is
terug te vinden in het OIN-register van Logius. Dit OIN wordt opgenomen
in het DMKS-bericht.</p><p>Indien de basisregistratie er om vraagt kan als extra
authenticatiemiddel signing van het DMKS-bericht met een
PKIoverheidcertificaat worden gevraagd. Dit certificaat dient van de
afnemende organisatie te zijn en het OIN te bevatten zoals uitgegeven
toen de organisatie zich aanmeldde voor Digikoppeling.</p><p>Op transportniveau wordt geautoriseerd op het OIN dat door de
Digikoppeling-adapter van de afnemende organisatie wordt gebruikt. Dit
wordt gebruikt in de Digikoppeling headers WS-Addressing (WUS) en
PartyID (ebMS) en in het PKIoverheidscertificaat dat voor transport
beveiliging (TLS) wordt gebruikt. Dit is niet altijd het OIN van de
organisatie zelf! Bij sectorale knooppunten, SaaS-oplossingen en
samenwerkingsverbanden kan dit mogelijk een ander OIN zijn. De interne
authenticatie en autorisatie (indien anders dan eHerkenning/SSOn-Rijk)
is volledig vrij door de afnemende organisatie in te vullen. Hiervan
hoeft niets meegegeven te worden in DMKS-berichten.</p><section id="protocollen"><h4 id="x4-1-1-protocollen"><bdi class="secno">4.1.1 </bdi>Protocollen<a class="self-link" href="#protocollen" aria-label="Permalink for Section 4.1.1"></a></h4><p>Bij synchrone communicatie wordt gebruik gemaakt van Digikoppeling WUS
volgens het '2W-be'-profiel[^2] met ondersteuning voor MTOM voor
efficiënt transport van attachments.</p><p>[^2]: Best Effort, beveiligd met tweezijdige TLS</p><p>Indien een basisregistratie verzoekt om een authenticatie van de
terugmeldende organisatie wordt bij synchrone communicatie gebruikt
gemaakt van WUS Profiel Digikoppeling 2W-be-S[^3].</p><p>[^3]: Best Effort, beveiligd met tweezijdige TLS en gesigneerde berichten</p></section></section></section>
  <section data-format="markdown" id="specificaties-services"><h2 id="x5-specificaties-services"><bdi class="secno">5. </bdi>Specificaties Services<a class="self-link" href="#specificaties-services" aria-label="Permalink for Section 5."></a></h2><p>Dit hoofdstuk beschrijft de berichten tussen terugmeldapplicatie,
Digimelding Webservice en de LV van basisregistraties (gerouteerd via
Digimelding Webservice)</p><p>Het interactiediagram biedt overzicht in hoe de berichten zich tot
elkaar verhouden en in welke volgorde de berichten worden gebruikt.</p><p>Per bericht wordt aangegeven (indien relevant):</p><ul>
<li><p>berichtnaam;</p>
</li>
<li><p>trigger van het bericht;</p>
</li>
<li><p>verandering in terugmeldapplicatie/Digimelding Webservice/LV
basisregistratie ten gevolge van het bericht;</p>
</li>
<li><p>lijst van objecten en velden in het bericht, en per veld:</p>
<ul>
<li><p>specificatie van de vulling van het veld,</p>
</li>
<li><p>toelichting, bijvoorbeeld met de gebruikersactie of configuratie
die nodig is om de juiste vulling te krijgen.</p>
</li>
</ul>
</li>
</ul><p>Tevens wordt bij de berichten een interactiediagram getoond waarin
duidelijk wordt welk systeem het bericht initieert.</p><section id="annotaties-algemeen"><h3 id="x5-1-annotaties-algemeen"><bdi class="secno">5.1 </bdi>Annotaties Algemeen<a class="self-link" href="#annotaties-algemeen" aria-label="Permalink for Section 5.1"></a></h3><p>De Digimelding-koppelvlakspecificatie (DMKS) die de basis vormt voor dit
koppelvlak gaat uit van annotaties. Alle informatie over een
terugmelding is vastgelegd in de vorm van een annotatie. Hierbij kent de
DMKS ook annotatiebomen waarbij root annotaties voorzien zijn van leaf
annotaties. De leafs zijn annotaties die een verwijzing bevatten naar de
UUID van de root annotatie waar ze aan hangen. In theorie is het
mogelijk dat een annotatie tegelijkertijd een root en leaf is, deze
annotatie hangt dan aan een andere 'root node' maar heeft zelf ook
leafs. Dit laatste komt in de huidige praktijk niet voor.</p><p>Iedere annotatie kent een basisset aan elementen: de 'annotatiebasis'
Deze worden bij iedere annotatie herhaald waardoor berichten behoorlijk
omvangrijk worden. Voor het overzicht wordt deze annotatie basis in de
volgende secties met specifieke berichten samengevat tot één regel
Annotatiebasis. Hieronder leggen we eenmalig uit welke elementen deze
annotatiebasis bevat.</p><table class="simple">
<thead>
<tr>
<th align="left"><strong>Annotatiebasis</strong></th>
<th align="left"></th>
</tr>
</thead>
<tbody><tr>
<td align="left">@uuid<br><em>Unieke identificatie van de annotatie.</em></td>
<td align="left">[1..1]</td>
</tr>
<tr>
<td align="left">GeannoteerdDoor<br><em>Gegevens van diegene die de annotatie heeft toegevoegd.</em></td>
<td align="left">[1..1]</td>
</tr>
<tr>
<td align="left">GeannoteerdDoor . Oin<br><em>OIN van de terugmeldende organisatie.</em></td>
<td align="left">[1..1]</td>
</tr>
<tr>
<td align="left">GeannoteerdDoor . Vestiging<br><em>Vestigingsnummer van desbetreffende organisatie uit eHerkenning/SSOn Rijk (indien door de afnemer toegepast voor authenticatie).</em></td>
<td align="left">[0..1]</td>
</tr>
<tr>
<td align="left">GeannoteerdDoor . Persoonsaanduiding<br><em>Deze zal met webservices bijna altijd de waarde "anoniem" hebben. Er zijn twee uitzonderingen. De eerste is wanneer nadere afspraken gemaakt zijn met een basisregistratie over de invulling van dit veld. De tweede is dat, indien binnen de organisatie eHerkenning/SSOn Rijk gebruikt is voor autorisatie en authenticatie, persoonsaanduiding uit eHerkenning/SSOn Rijk dient te worden meegegeven.</em></td>
<td align="left">[1..1]</td>
</tr>
<tr>
<td align="left">GeannoteerdOp<br><em>Tijdstempel waarop de annotatie heeft plaatsgevonden</em>.</td>
<td align="left">[1..1]</td>
</tr>
<tr>
<td align="left">Toelichting<br><em>Een toelichting bij de annotatie. In de huidige praktijk in gebruik voor root annotaties en status leaf annotaties voor overige leaf annotaties in de huidige praktijk altijd leeg.</em></td>
<td align="left">[0..1]</td>
</tr>
<tr>
<td align="left">Annotatieverwijzing<br><em>Verwijzing naar de root annotatie waar een leaf annotatie aan gerelateerd is. Dit wordt afhankelijk  van de relevantie opgenomen.</em></td>
<td align="left">[0..1]</td>
</tr>
</tbody></table></section><section id="annotatie-versturen"><h3 id="x5-2-annotatie-versturen"><bdi class="secno">5.2 </bdi>Annotatie versturen<a class="self-link" href="#annotatie-versturen" aria-label="Permalink for Section 5.2"></a></h3><p>De berichten beschreven in deze uitwisseling worden gebruikt om:</p><ul>
<li>met de terugmeldapplicatie van een afnemer een terugmelding te
versturen</li>
<li>om een eerder door de afnemer gedane terugmelding in te trekken</li>
<li>om een status terug te melden van een bronhouder naar een Landelijke
Voorziening</li>
</ul><section id="algemeen"><h4 id="x5-2-1-algemeen"><bdi class="secno">5.2.1 </bdi>Algemeen<a class="self-link" href="#algemeen" aria-label="Permalink for Section 5.2.1"></a></h4><table class="simple">
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>Doel</td>
<td>Het toevoegen van een annotatie(boom) bij een op Digimelding aangesloten basisregistratie door een (medewerker van) een organisatie.<br>Het effect van het annotatie toevoegen, <strong>terugmelden</strong> is het doen van een terugmelding.<br>Het effect van een annotatie toevoegen, <strong>intrekken</strong> is het intrekken van een terugmelding.<br> Het effect van een annotatie toevoegen, <strong>statuswijziging</strong> is het geven van een statusupdate.</td>
</tr>
<tr>
<td>Voorwaarde</td>
<td>Afname van gegevens uit basisregistraties door de terugmeldende organisatie, en het gedaan hebben van een check van de actuele waarde in de basisregistratie bij het doen van een terugmelding.<br>Voor het <strong>intrekken</strong> van een terugmelding moet er al een terugmelding gedaan is.<br>Voor het verzenden van een <strong>statuswijziging</strong> moet een terugmelding zijn ontvangen door de bronhouder</td>
</tr>
<tr>
<td>Trigger</td>
<td>Gerede twijfel over de juistheid van een gegeven in een op Digimelding aangesloten basisregistratie bij een ambtenaar binnen de organisatie.<br>Het terugkomen op de gerede twijfel van een eerder gedane terugmelding in het geval van <strong>intrekken</strong>.<br>Het veranderen van een status door middel van een <strong>statuswijziging</strong> van een terugmelding bij een bronhouder.</td>
</tr>
<tr>
<td>Direct gevolg</td>
<td>Versturen van een bericht naar de betreffende bronhouder of landelijke voorziening.</td>
</tr>
<tr>
<td>Vervolgactie</td>
<td>De landelijke voorziening van de basisregistratie  neemt de terugmelding in behandeling. De gebruiker van de terugmeldende organisatie kan dit volgen  middels status opvragen.<br>De landelijke voorziening verwerkt de statusupdate.</td>
</tr>
</tbody></table></section><section id="scenario-s-communicatie"><h4 id="x5-2-2-scenario-s-communicatie"><bdi class="secno">5.2.2 </bdi>Scenario's Communicatie<a class="self-link" href="#scenario-s-communicatie" aria-label="Permalink for Section 5.2.2"></a></h4><p><figure id="fig-interactiediagram-terugmelden-intrekken-direct"><img src="images/image3.png" alt="Interactiediagram terugmelden/intrekken direct" title="Interactiediagram terugmelden/intrekken direct"><figcaption>Figuur <bdi class="figno">3</bdi> <span class="fig-title">Interactiediagram terugmelden/intrekken direct</span></figcaption></figure></p><p><figure id="fig-interactiediagram-terugmelden-intrekken-via-digimelding-webservice"><img src="images/image4.png" alt="Interactiediagram terugmelden/intrekken via Digimelding Webservice" title="Interactiediagram terugmelden/intrekken via Digimelding Webservice"><figcaption>Figuur <bdi class="figno">4</bdi> <span class="fig-title">Interactiediagram terugmelden/intrekken via Digimelding Webservice</span></figcaption></figure></p><p><figure id="fig-interactiediagram-status-wijzigen"><img src="images/image5.png" alt="Interactiediagram status wijzigen" title="Interactiediagram status wijzigen"><figcaption>Figuur <bdi class="figno">5</bdi> <span class="fig-title">Interactiediagram status wijzigen</span></figcaption></figure></p></section><section id="inhoud-bericht-annotatie-toevoegenrequest"><h4 id="x5-2-3-inhoud-bericht-annotatie-toevoegenrequest"><bdi class="secno">5.2.3 </bdi>Inhoud bericht Annotatie ToevoegenRequest<a class="self-link" href="#inhoud-bericht-annotatie-toevoegenrequest" aria-label="Permalink for Section 5.2.3"></a></h4><table class="simple">
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td><strong>AnnotatieToevoegenRequest</strong></td>
<td></td>
</tr>
<tr>
<td>OinBasisregistratie<br>Het OIN van de houder van een landelijke voorziening van de basisregistratie</td>
<td>[1..1]</td>
</tr>
<tr>
<td>Registratie<br>Code (maximaal 3 letterig) waarmee de basisregistratie wordt aangeduid wanneer de houder van een landelijke  voorziening meer dan 1 basisregistratie beheert (bv BRT, BGT).</td>
<td>[0..1]</td>
</tr>
<tr>
<td>Annotatie<br><em>Dit element wordt alleen gevuld met een annotatie die moet worden ingetrokken.</em></td>
<td>[1..1]*</td>
</tr>
<tr>
<td>AnnotatieBoom<br><em>Bestaat uit minimaal één annotatie (de terugmelding) en de bijbehorende leafs.</em></td>
<td>[1..1]*</td>
</tr>
</tbody></table><p>* De elementen Annotatie en AnnotatieBoom zijn onderdeel van een
verplicht keuzeveld: de AnnotatieToevoegenRequest bevat altijd slechts
één van de twee.</p><section id="annotatie-toevoegen-terugmelden"><h5 id="x5-2-3-1-annotatie-toevoegen-terugmelden"><bdi class="secno">5.2.3.1 </bdi>Annotatie toevoegen (terugmelden)<a class="self-link" href="#annotatie-toevoegen-terugmelden" aria-label="Permalink for Section 5.2.3.1"></a></h5><p>De structuur van de instanties van 'Annotatie' in de 'AnnotatieBoom' is
als volgt:</p><table class="simple">
<thead>
<tr>
<th><strong>AnnotatieBoom . Annotatie</strong></th>
<th>[1..*]</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Annotatie . Terugmelding</strong></td>
<td>[1..1]</td>
</tr>
<tr>
<td>Terugmelding . <strong>Annotatiebasis</strong></td>
<td></td>
</tr>
<tr>
<td>Terugmelding . Bronverwijzingen<br><em>Bronverwijzingen bestaande uit één of meerdere bronverwijzing</em><br><em>Lijst van verwijzingen met basisregistratie elementen waarop wordt teruggemeld.</em></td>
<td>[1..1]</td>
</tr>
<tr>
<td>Terugmelding . Bronverwijzingen . Bronverwijzing<br><em>Bestaande uit een URI en een selectieverwijzing naar het basisregistratie-element waarop wordt teruggemeld. Dit zijn er meerdere, maar in de huidige praktijk is dit er altijd precies één.</em></td>
<td>[1..*]</td>
</tr>
<tr>
<td>Terugmelding . Bronverwijzingen . Bronverwijzing .  Uri<br> <em>Een combinatie van OIN en de unieke sleutel van het brongegeven zodat een unieke referentie ontstaat naar het brongegeven (bijv. OIN en HRN).</em></td>
<td>[1..1]</td>
</tr>
<tr>
<td>Terugmelding . Bronverwijzingen . Bronverwijzing . Selectie<br> <em>Selectie van een element binnen de structuur die door de URI uniek geïdentificeerd wordt (bijvoorbeeld onderneming).</em></td>
<td>[0..*]</td>
</tr>
<tr>
<td>Terugmelding . Attributenset<br> <em>De set van attributen die daadwerkelijk gewijzigd dienen te worden.</em></td>
<td>[1..1]</td>
</tr>
<tr>
<td>Attribuut<br><em>Eén of meerdere attributen die gewijzigd dienen te worden.</em></td>
<td>[1..*]</td>
</tr>
<tr>
<td>Attribuut . Uri<br>De unieke aanduiding van het attribuut</td>
<td>[1..1]</td>
</tr>
<tr>
<td>Attribuut . BetwijfeldeWaarde<br><em>De bestaande waarde in de basisregistratie.</em></td>
<td>[0..1]</td>
</tr>
<tr>
<td>Attribuut . VoorgesteldeWaarde<br><em>De voorgestelde nieuwe waarde.</em></td>
<td>[0..1]</td>
</tr>
<tr>
<td>Terugmelding . Peilmoment<br><em>De datum waarop de betwijfelde waarde geldig is en de voorgestelde waarde geldig zou moeten zijn.</em></td>
<td>[0..1]</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td><strong>Annotatie . Annotatiestatus</strong><br><em>Status van de terugmelding</em></td>
<td>[1..*]</td>
</tr>
<tr>
<td>Annotatiestatus . <strong>Annotatiebasis</strong></td>
<td></td>
</tr>
<tr>
<td>Annotatiestatus . Status<br> <em>Zie bijlage B voor lijst met geadviseerde statussen voor aangesloten basisregistraties.(Het is toegestaan om in de eigen catalogus afwijkende statussen op te nemen)</em></td>
<td>[1..1]</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td><strong>Annotatie . Referentiekenmerk</strong><br><em>Eigen kenmerk terugmeldende organisatie (het mogen er meer zijn, in de huidige praktijk altijd precies één).</em></td>
<td>[1..*]</td>
</tr>
<tr>
<td>Referentiekenmerk . <strong>Annotatiebasis</strong></td>
<td></td>
</tr>
<tr>
<td>Referentiekenmerk . Kenmerk<br><em>Eigen kenmerk terugmeldende organisatie.</em><br><em>In de huidige praktijk maximaal 12 posities</em></td>
<td>[1..1]</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td><strong>Annotatie . Contactinformatie</strong><br><em>Contactgegevens</em></td>
<td>[1..*]</td>
</tr>
<tr>
<td>Contactinformatie . @ContactType<br><em>kan alleen de waarden 'Melder' of 'Behandelaar' hebben</em></td>
<td>[1..1]</td>
</tr>
<tr>
<td>Contactinformatie . <strong>Annotatiebasis</strong></td>
<td></td>
</tr>
<tr>
<td>Contactinformatie . Naam</td>
<td>[1..1]</td>
</tr>
<tr>
<td>Contactinformatie . Telefoon</td>
<td>[0..1]</td>
</tr>
<tr>
<td>Contactinformatie . Email</td>
<td>[1..1]</td>
</tr>
<tr>
<td>Contactinformatie . Afdeling</td>
<td>[0..1]</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td><strong>Annotatie . Bijlageverwijzing</strong></td>
<td>[0..*]</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td>&gt; <em>HR ondersteunt maximaal 5 bijlagen.</em></td>
<td></td>
</tr>
<tr>
<td>Bijlageverwijzing . <strong>Annotatiebasis</strong></td>
<td></td>
</tr>
<tr>
<td>Bijlageverwijzing . Bestandsnaam<br><em>De naam van het bestand.</em></td>
<td>[1..1]</td>
</tr>
<tr>
<td>Bijlageverwijzing . MIMEType<br><em>Het MIME type van de bijlage.</em></td>
<td>[1..1]</td>
</tr>
<tr>
<td>Bijlageverwijzing . BijlageData<br><em>Het bestand zelf in Base64-binary encoding.</em></td>
<td>[1..1]</td>
</tr>
<tr>
<td>Bijlageverwijzing . Beschrijving<br><em>Beschrijving van de bijlage. De bijlage zelf wordt nooit mee teruggeleverd bij het bevragen van een terugmelding/annotatie.</em></td>
<td>[0..1]</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td><strong>Annotatie . BehandelendeBronhouder</strong><br><em>Behandelende bronhouder</em></td>
<td>[0 *]</td>
</tr>
<tr>
<td>BehandelendeBronhouder . <strong>Annotatiebasis</strong></td>
<td></td>
</tr>
<tr>
<td>BehandelendeBronhouder . Bronhouder<br><em>De gewenste bronhouder</em></td>
<td>[1..1]</td>
</tr>
</tbody></table></section><section id="annotatie-toevoegen-intrekken"><h5 id="x5-2-3-2-annotatie-toevoegen-intrekken"><bdi class="secno">5.2.3.2 </bdi>Annotatie toevoegen (intrekken)<a class="self-link" href="#annotatie-toevoegen-intrekken" aria-label="Permalink for Section 5.2.3.2"></a></h5><p>De volgende structuur is in de XML-structuur child van de 'Annotatie'.</p><table class="simple">
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td><strong>Annotatiestatus</strong><br><em>Status van de terugmelding.</em></td>
<td>[1..*]</td>
</tr>
<tr>
<td><strong>Annotatiestatus . Annotatiebasis</strong><br>Inclusief toelichting en annotatieverwijzing</td>
<td></td>
</tr>
<tr>
<td>Annotatiestatus . Status<br>Een afnemer kan bij het doen van een intrekking alleen de status: INGETROKKEN gebruiken in de huidige praktijk.</td>
<td>[0..1]</td>
</tr>
</tbody></table><p><strong>Annotatie toevoegen (statuswijziging)</strong>
De volgende structuur is in de XML-structuur child van de 'Annotatie'.</p><table class="simple">
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td><strong>Annotatiestatus</strong><br><em>Status van de terugmelding.</em></td>
<td>[1..*]</td>
</tr>
<tr>
<td><strong>Annotatiestatus . Annotatiebasis</strong><br>Inclusief toelichting en annotatieverwijzing</td>
<td></td>
</tr>
<tr>
<td>Annotatiestatus . Status<br><em>Zie bijlage B voor lijst met geadviseerde statussen voor aangesloten basisregistraties.(Het is toegestaan om in de eigen catalogus afwijkende statussen op te nemen)</em></td>
<td>[0..1]</td>
</tr>
<tr>
<td>Annotatiestatus . Statustype</td>
<td>[0..1]</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td><strong>Annotatie . Contactinformatie</strong><br><em>Contactgegevens.</em></td>
<td>[0..*]</td>
</tr>
<tr>
<td>Contactinformatie . @ContactType<br><em>kan alleen de waarden 'Melder' of 'Behandelaar' hebben</em></td>
<td>[1..1]</td>
</tr>
<tr>
<td><strong>Contactinformatie . Annotatiebasis</strong></td>
<td></td>
</tr>
<tr>
<td>Contactinformatie . Naam</td>
<td>[1..1]</td>
</tr>
<tr>
<td>Contactinformatie . Telefoon</td>
<td>[0..1]</td>
</tr>
<tr>
<td>Contactinformatie . Email</td>
<td>[1..1]</td>
</tr>
<tr>
<td>Contactinformatie . Afdeling</td>
<td>[0..1]</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td><strong>Annotatie . Planningsverwachting</strong><br><em>Verwachte termijn voor behandeling</em></td>
<td>[0..*]</td>
</tr>
<tr>
<td>Planningsverwachting . <strong>Annotatiebasis</strong></td>
<td></td>
</tr>
<tr>
<td>Planningsverwachting . MijlpaalAanduiding<br><em>Beschrijving van de planningsverwachting.</em></td>
<td>[0..1]</td>
</tr>
<tr>
<td>Planningsverwachting . MijlpaalTijdstempel<br><em>Datum waarop de planning gereed is.</em></td>
<td>[0..1]</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td><strong>Annotatie . BehandelendeBronhouder</strong><br><em>Behandelende bronhouder</em></td>
<td>[0 *]</td>
</tr>
<tr>
<td>BehandelendeBronhouder . <strong>Annotatiebasis</strong></td>
<td></td>
</tr>
<tr>
<td>BehandelendeBronhouder . Bronhouder<br><em>De gewenste bronhouder (bij status "Verkeerde Bronhouder")</em></td>
<td>[1..1]</td>
</tr>
</tbody></table><p>Optioneel kan bij een statuswijziging worden meegezonden:</p><p>Planningsverwachting, Contactinformatie en Behandelendbronhouder
(hiermee kan bij de statuswijziging <em>"Verkeerde Bronhouder"</em> de gewenste
bronhouder worden aangegeven).</p></section><section id="annotatie-toevoegen-aanpassing"><h5 id="x5-2-3-3-annotatie-toevoegen-aanpassing"><bdi class="secno">5.2.3.3 </bdi>Annotatie toevoegen (aanpassing)<a class="self-link" href="#annotatie-toevoegen-aanpassing" aria-label="Permalink for Section 5.2.3.3"></a></h5><p>Het antwoord op het toevoegen van een annotatie of het nu een
annotatieboom met volledige terugmelding is of een annotatie voor een
intrekking is altijd een AnnotatieToevoegenResponse-bericht met daarin
een tijdstempel. Het is een zogeheten functionele acknowledgement wat
betekent dat de achterliggende (TMV-)applicatie het vraagbericht in
goede orde ontvangen heeft.</p><table class="simple">
<thead>
<tr>
<th><strong>Berichttype:</strong> AnnotatieToevoegenResponse</th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td><strong>Elementen/attributen</strong></td>
<td></td>
</tr>
<tr>
<td>AnnotatieToevoegenResponse</td>
<td></td>
</tr>
<tr>
<td>AnnotatieToevoegenResponse . Tijdstempel<br><em>Tijd waarop antwoord verstuurd is.</em></td>
<td>[1..1]</td>
</tr>
<tr>
<td>AnnotatieToevoegenResponse . AnnotatieVerwijzing<br><em>UUID van de toegevoegde annotatie waar het antwoord betrekking op heeft.</em></td>
<td>[1..1]</td>
</tr>
</tbody></table></section></section></section><section id="status-bevragen"><h3 id="x5-3-status-bevragen"><bdi class="secno">5.3 </bdi>Status bevragen<a class="self-link" href="#status-bevragen" aria-label="Permalink for Section 5.3"></a></h3><p>Deze interactie wordt gebruikt door de afnemer om meer informatie te
verkrijgen over de door zijn organisatie gedane terugmeldingen en de
huidige status van deze terugmeldingen.</p><section id="algemeen-0"><h4 id="x5-3-1-algemeen"><bdi class="secno">5.3.1 </bdi>Algemeen<a class="self-link" href="#algemeen-0" aria-label="Permalink for Section 5.3.1"></a></h4><table class="simple">
<thead>
<tr>
<th align="left"></th>
<th align="left"></th>
</tr>
</thead>
<tbody><tr>
<td align="left">Doel</td>
<td align="left">Het opvragen van de status van terugmeldingen van een terugmeldende organisatie.</td>
</tr>
<tr>
<td align="left">Voorwaarde</td>
<td align="left">De organisatie heeft terugmeldingen gedaan.</td>
</tr>
<tr>
<td align="left">Trigger</td>
<td align="left">Een gebruiker wil de status van terugmeldingen van zijn organisatie weten.</td>
</tr>
<tr>
<td align="left">Direct gevolg</td>
<td align="left">De gebruiker is geïnformeerd over de status en eventueel extra detailinformatie van de terugmeldingen die hem interesseren.</td>
</tr>
<tr>
<td align="left">Vervolgactie</td>
<td align="left">De gebruiker kan terugmeldingen van zijn organisatie intrekken op basis van de informatie verstrekt in het status overzicht.</td>
</tr>
<tr>
<td align="left">Bijzonderheden</td>
<td align="left">-</td>
</tr>
</tbody></table></section><section id="statusoverzichtrequest"><h4 id="x5-3-2-statusoverzichtrequest"><bdi class="secno">5.3.2 </bdi>StatusoverzichtRequest<a class="self-link" href="#statusoverzichtrequest" aria-label="Permalink for Section 5.3.2"></a></h4><p>Het bericht StatusoverzichtRequest wordt gebruikt in de communicatie
tussen Afnemer en LV/Basisregistratie alsook tussen LV/Basisregistratie
en Bronhouder om een statusoverzicht op te vragen.</p><p>Ter illustratie onderstaand de interactie tussen Afnemer en
Basisregistratie.</p><p><figure id="fig-interactiediagram-status-opvragen-via-de-digimelding-webservice"><img src="images/image6.png" alt="Interactiediagram status opvragen via de Digimelding Webservice" title="Interactiediagram status opvragen via de Digimelding Webservice"><figcaption>Figuur <bdi class="figno">6</bdi> <span class="fig-title">Interactiediagram status opvragen via de Digimelding Webservice</span></figcaption></figure></p><p><figure id="fig-interactiediagram-status-opvragen-rechtstreeks"><img src="images/image7.png" alt="Interactiediagram status opvragen rechtstreeks" title="Interactiediagram status opvragen rechtstreeks"><figcaption>Figuur <bdi class="figno">7</bdi> <span class="fig-title">Interactiediagram status opvragen rechtstreeks</span></figcaption></figure></p><p>Het statusoverzicht wordt opgevraagd op basis van de verplichte
elementen OIN en basisregistratie. Het OIN is verplicht omdat alle
aangesloten basisregistraties alleen van plan zijn terugmeldingen van de
afnemer zelf terug te geven. Basisregistratie is verplicht, omdat dit
het doorgeven van functionele fouten door de Digimelding Webservice
vergemakkelijkt. Dit is een beperkte voorziening, het samenvoegen van
overzichtsberichten zou de complexiteit verhogen en vooral op een goede
wijze functionele fouten over meerdere basisregistraties heen geven,
levert teveel complexiteit op. In het geval dat het opgeven van één
basisregistratie verplicht is routeert de Digimelding Webservice
slechts. Naast deze verplichte elementen is er een aantal optionele
elementen waarmee de resultaten gefilterd kunnen worden. Een lijst met
kenmerken van de organisatie zelf kan worden meegegeven. Dit is handig
wanneer de afnemer een eigen registratiesysteem heeft. Daarnaast kan
gefilterd worden op de datum van indienen en de datum van laatste
wijziging. Tot slot kan er gefilterd worden op de status van
terugmeldingen. Dit is enigszins bewerkelijk aangezien iedere
basisregistratie zijn eigen statussen mag definiëren. In de
berichtenschema's is daarom slechts vastgelegd dat dit een string is.</p><table class="simple">
<thead>
<tr>
<th><strong>Berichttype</strong>: StatusoverzichtRequest</th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td><strong>Elementen/attributen</strong></td>
<td></td>
</tr>
<tr>
<td>OinVragendeOrganisatie&gt;br&gt;<em>OIN van de vragende organisatie.</em></td>
<td>[1..1]</td>
</tr>
<tr>
<td>OinBasisregistratie<br>*Het OIN van de houder van een landelijke voorziening van de basisregistratie</td>
<td>[1..1]</td>
</tr>
<tr>
<td>Registratie<br>Code (maximaal 3 letterig) waarmee de basisregistratie wordt aangeduid wanneer de houder van een landelijke voorziening meer dan 1 basisregistratie beheert (bv BRT, BGT).</td>
<td>[0..1]</td>
</tr>
<tr>
<td><strong>Filter</strong></td>
<td>[0..1]</td>
</tr>
<tr>
<td>Filter.MeldingskenmerkenLijst<br><em>(Lijst met)Eigen kenmerk(en) terugmeldende organisatie.</em></td>
<td>[0..1]</td>
</tr>
<tr>
<td>Filter.MeldingskenmerkenLijst.MeldinggkenmerkLijstElement</td>
<td>[1..*]</td>
</tr>
<tr>
<td>Filter.VanafTijdstempelIndienen<br><em>Filtert resultaten die zijn ingediend voor dit tijdstempel weg. Resultaten op de tijdstempel of daarna worden getoond.</em></td>
<td>[0..1]</td>
</tr>
<tr>
<td>Filter.TotEnMetTijdstempelIndienen<br>  <em>Filtert resultaten die zijn ingediend na dit tijdstempel weg. Resultaten op de tijdstempel of daarvoor worden getoond.</em></td>
<td>[0..1]</td>
</tr>
<tr>
<td>Filter.VanafTijdstempelWijziging<br><em>Filtert resultaten die zijn gewijzigd voor dit tijdstempel weg. Resultaten op de tijdstempel of daarna worden getoond[^7].</em></td>
<td>[0..1]</td>
</tr>
<tr>
<td>Filter.TotEnMetTijdstempelWijziging<br><em>Filtert resultaten die zijn gewijzigd na dit tijdstempel weg. Resultaten op de tijdstempel of daarvoor worden getoond[^7].</em></td>
<td>[0..1]</td>
</tr>
<tr>
<td>Filter.StatusTerugmelding<br><em>String met daarin een status behorende bij de basisregistratie waarvan het overzicht gevraagd wordt.</em></td>
<td>[0..1]</td>
</tr>
<tr>
<td>Filter.Objectidentificatie<br><em>String met daarin een objectidentificatie behorende bij de basisregistratie waarvan het overzicht gevraagd wordt. Hiermee kunnen terugmeldingen ook op basis van KvK-nummer, BSN-nummer, BAG-id, etc teruggevonden worden.</em></td>
<td>[0..1]</td>
</tr>
</tbody></table><p>[^7]: <em>Het resultaat</em> betreft terugmeldingen (annotatiebomen) waarvoor
geldt dat <strong>de laatste annotatie</strong> is toegevoegd tussen
VanafTijdstempelWijziging en TotEnMetTijdstempelWijziging</p></section><section id="statusoverzichtresponse"><h4 id="x5-3-3-statusoverzichtresponse"><bdi class="secno">5.3.3 </bdi>StatusoverzichtResponse<a class="self-link" href="#statusoverzichtresponse" aria-label="Permalink for Section 5.3.3"></a></h4><p>Het statusoverzicht geeft een lijst met annotaties terug. Dit zijn in
dit geval altijd 'root' annotaties waar een annotatieboom aan hangt. Dit
is noodzakelijk omdat een aantal van de kenmerken die in de
annotatielijst verplicht worden meegegeven afkomstig zijn uit leaf
annotaties van een annotatieboom.</p><p>Wanneer het antwoord op een statusoverzichtbevraging niets oplevert
wordt een lege lijst meegegeven. In lijn met het 'gemeenschappelijke
afspraken berichtstandaarden'-voorstel voor 'geen waarde' wordt hierbij
als reden meegegeven 'geenWaarde'. Een regulier antwoordbericht is in
deze foutsituaties op zijn plaats omdat dit geen kritieke fouten zijn en
het aan de afnemer is om te bepalen of hier actie op moet worden
ondernomen.</p><table class="simple">
<thead>
<tr>
<th><strong>Berichttype</strong>: StatusoverzichtResponse</th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td><strong>Elementen/attributen</strong></td>
<td></td>
</tr>
<tr>
<td>---------------------------------------------------------</td>
<td>-----------</td>
</tr>
<tr>
<td><strong>AnnotatieLijst</strong></td>
<td>[1..*]</td>
</tr>
<tr>
<td>---------------------------------------------------------</td>
<td>-----------</td>
</tr>
<tr>
<td>Annotatie</td>
<td>[0..*]</td>
</tr>
<tr>
<td>---------------------------------------------------------</td>
<td>-----------</td>
</tr>
<tr>
<td>Annotatie . Tijdstempel<br><em>Datum/tijd waarop de annotatie heeft plaatsgevonden</em></td>
<td>[1..1]</td>
</tr>
<tr>
<td>---------------------------------------------------------</td>
<td>-----------</td>
</tr>
<tr>
<td>Annotatie . Uuid<br><em>Unieke verwijzing naar de root annotatie van een annotatieboom.</em></td>
<td>[1..1]</td>
</tr>
<tr>
<td>---------------------------------------------------------</td>
<td>-----------</td>
</tr>
<tr>
<td>Annotatie . Meldingskenmerk<br><em>Eigen kenmerk terugmeldende organisatie.</em></td>
<td>[1..1]</td>
</tr>
<tr>
<td>---------------------------------------------------------</td>
<td>-----------</td>
</tr>
<tr>
<td>Annotatie . Bronverwijzing</td>
<td>[1..1]</td>
</tr>
<tr>
<td>---------------------------------------------------------</td>
<td>-----------</td>
</tr>
<tr>
<td>Annotatie . Bronverwijzing . Uri<br><em>Een combinatie van OIN en de unieke sleutel van het brongegeven zodat een unieke referentie ontstaat naar het brongegeven (bijv. OIN en HRN).</em></td>
<td>[1..1]</td>
</tr>
<tr>
<td>---------------------------------------------------------</td>
<td>-----------</td>
</tr>
<tr>
<td>Annotatie . Bronverwijzing . Selectie<br><em>Object waarop is teruggemeld.</em></td>
<td>[0..1]</td>
</tr>
<tr>
<td>---------------------------------------------------------</td>
<td>-----------</td>
</tr>
<tr>
<td>Annotatie . Annotatiestatus<br><em>Laatste status annotatie van de terugmelding.</em></td>
<td>[1..1]</td>
</tr>
</tbody></table></section><section id="detailsterugmeldingrequest"><h4 id="x5-3-4-detailsterugmeldingrequest"><bdi class="secno">5.3.4 </bdi>DetailsTerugmeldingRequest<a class="self-link" href="#detailsterugmeldingrequest" aria-label="Permalink for Section 5.3.4"></a></h4><p>Het bericht DetailsTerugmeldingRequest wordt gebruikt in de communicatie
tussen Afnemer en LV/Basisregistratie alsook tussen LV/Basisregistratie
en Bronhouder om details van een bepaalde terugmelding op te vragen.</p><p>Ter illustratie onderstaand de interactie tussen Afnemer en
Basisregistratie.</p><p><figure id="fig-interactiediagram-details-terugmelding-bevragen-via-digimelding-webservice"><img src="images/image8.png" alt="Interactiediagram details terugmelding bevragen via Digimelding Webservice" title="Interactiediagram details terugmelding bevragen via Digimelding Webservice"><figcaption>Figuur <bdi class="figno">8</bdi> <span class="fig-title">Interactiediagram details terugmelding bevragen via Digimelding Webservice</span></figcaption></figure></p><p><figure id="fig-interactiediagram-detail-terugmelding-bevragen-rechtstreeks"><img src="images/image9.png" alt="Interactiediagram detail terugmelding bevragen rechtstreeks" title="Interactiediagram detail terugmelding bevragen rechtstreeks"><figcaption>Figuur <bdi class="figno">9</bdi> <span class="fig-title">Interactiediagram detail terugmelding bevragen rechtstreeks</span></figcaption></figure></p><p>Het doel van dit bericht is het opvragen van alle informatie over één
terugmelding bij een basisregistratie. Hiervoor wordt het OIN van de
afnemer meegegeven en de basisregistratie waar de detailopvraging wordt
gedaan, tot slot wordt de UUID van de annotatie meegegeven. In de
huidige praktijk gaat het altijd om een UUID van een root annotatie.
Volgens het protocol kan ook een individuele leaf annotatie of een
deelboom worden opgevraagd. Dit is nu in theorie mogelijk maar wordt in
de praktijk niet toegepast en is niet getest.</p><table class="simple">
<thead>
<tr>
<th><strong>Berichttype</strong>: DetailsTerugmeldingRequest</th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td><strong>Elementen/attributen</strong></td>
<td></td>
</tr>
<tr>
<td>----------------------------------------------------------</td>
<td>----------</td>
</tr>
<tr>
<td>OinVragendeOrganisatie<br><em>Identificatie d.m.v. OIN-vragende organisatie.</em></td>
<td>[1..1]</td>
</tr>
<tr>
<td>----------------------------------------------------------</td>
<td>----------</td>
</tr>
<tr>
<td>OinBasisregistratie<br>Het OIN van de houder van een landelijke voorziening van de basisregistratie</td>
<td>[1..1]</td>
</tr>
<tr>
<td>----------------------------------------------------------</td>
<td>----------</td>
</tr>
<tr>
<td>Registratie<br>Code (maximaal 3 letterig) waarmee de basisregistratie wordt aangeduid wanneer de houder van een landelijke voorziening meer dan 1 basisregistratie beheert (bv BRT, BGT).</td>
<td>[0..1]</td>
</tr>
<tr>
<td>----------------------------------------------------------</td>
<td>----------</td>
</tr>
<tr>
<td>Uuid<br><em>UUID van root annotatie.</em></td>
<td>[1..1]</td>
</tr>
</tbody></table></section><section id="detailsterugmeldingresponse"><h4 id="x5-3-5-detailsterugmeldingresponse"><bdi class="secno">5.3.5 </bdi>DetailsTerugmeldingResponse<a class="self-link" href="#detailsterugmeldingresponse" aria-label="Permalink for Section 5.3.5"></a></h4><p>Op basis van een UUID geeft een basisregistratie de annotatie met
daaraan hangende leafs terug als antwoord. Op dit moment is dat altijd
een toevoeging of wijziging (terugmelding) als root annotatie met
daaraan altijd tenminste één van elk van de volgende leafs: contact,
meldingskenmerk en/of status. Daarnaast worden optioneel één of meerdere
leafs van het type: Bijlageverwijzing en Planningsverwachting
meegegeven.</p><p>Een basisregistratie moet het opvragen van root annotaties met eraan
hangende boom ondersteunen, daarnaast mag een basisregistratie
annotatie(bomen) teruggeven van niet root annotaties, dit is echter nu
nog niet gerealiseerd of getest. Aangezien het statusoverzicht alleen
root annotaties oplevert zal het opvragen van andere soorten annotaties
in de praktijk ook niet snel voorkomen.</p><p>Doordat de annotatiebasis in iedere annotatie zit wordt de annotatieboom
een behoorlijk lijvige constructie. In de onderstaande berichten wordt
deze daarom tot één regel afgekort. Zie paragraaf 4.1 voor een
uitgebreide toelichting van wat er in de annotatiebasis staat. Elke
annotatie kent een eigen instantie, zoals ook bij
'AnnotatieToevoegenRequest' en elke annotatie kan slechts één van de
volgende soorten annotaties bevatten: Terugmelding, Annotatiestatus,
Referentiekenmerk, Contactinformatie, Bijlageverwijzing,
Planningsverwachting en BehandelendeBronhouder.</p><p>| <strong>Berichttype</strong>: DetailsTerugmeldingResponse            |           |
| <strong>Elementen/attributen</strong>                                |           |
| <strong>AnnotatieBoom</strong>                                       | [1..1]  |
|                                                         |           |
| &gt; *De container die de verzameling annotaties bevat die |           |
| &gt; ofwel het gevraagde UUID als kenmerk hebben of daar   |           |</p><table class="simple">
<thead>
<tr>
<th>&gt; middels een annotatieverwijzing naar verwijzen.*</th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td><strong>Annotatie . Terugmelding</strong><br><em>De terugmelding (de annotatie die uiteindelijk de root annotatie zal worden)</em></td>
<td>[1..1]</td>
</tr>
<tr>
<td>Terugmelding . <strong>Annotatiebasis</strong></td>
<td></td>
</tr>
<tr>
<td>Terugmelding . Bronverwijzingen<br><em>Bronverwijzingen bestaande uit één of meerdere bronverwijzing(en)</em><br><em>Lijst van verwijzingen met basisregistratie elementen waarop wordt teruggemeld.</em></td>
<td>[1..1]</td>
</tr>
<tr>
<td>Bronverwijzingen . Bronverwijzing<br><em>Bestaande uit een URI en een selectieverwijzing naar het basisregistratie element waarop wordt teruggemeld. Dit mogen er meerdere zijn, maar in de huidige praktijk is dit er altijd precies één.</em></td>
<td>[1..*]</td>
</tr>
<tr>
<td>Bronverwijzing.Uri<br><em>De URI die de combinatie van basisregistratie en sleutel (bijvoorbeeld BSN of HRN) uniek identificeert.</em></td>
<td>[1..1]</td>
</tr>
<tr>
<td>Bronverwijzing.Selectie<br>  <em>Selectie van een element binnen de structuur die door de URI uniek geïdentificeerd wordt (bijvoorbeeld onderneming).</em></td>
<td>[0..*]</td>
</tr>
<tr>
<td>Terugmelding . Attributenset<br><em>De set van attributen die daadwerkelijk gewijzigd dienen te worden.</em></td>
<td>[1..1]</td>
</tr>
<tr>
<td>Attributenset . Attribuut<br><em>Eén of meerdere attributen die gewijzigd dienen te worden.</em></td>
<td>[1..*]</td>
</tr>
<tr>
<td>Attribuut . Uri<br>De unieke aanduiding van het attribuut</td>
<td>[1..1]</td>
</tr>
<tr>
<td>Attribuut . BetwijfeldeWaarde<br><em>De bestaande waarde in de basisregistratie.</em></td>
<td>[0..1]</td>
</tr>
<tr>
<td>Attribuut . VoorgesteldeWaarde<br><em>De voorgestelde nieuwe waarde.</em></td>
<td>[0..1]</td>
</tr>
<tr>
<td>Terugmelding . Peilmoment<br><em>De datum waarop de betwijfelde waarde geldig is en de voorgestelde waarde geldig zou moeten zijn.</em></td>
<td>[0..1]</td>
</tr>
<tr>
<td>---------------------------------------------------------</td>
<td>-----------</td>
</tr>
<tr>
<td><strong>Annotatie . Annotatiestatus</strong><br><em>Status van de terugmelding, de status met de meest recente datum GeannoteerdOp is de geldige status.</em></td>
<td>[1..*]</td>
</tr>
<tr>
<td>Annotatiestatus . <strong>Annotatiebasis</strong></td>
<td></td>
</tr>
<tr>
<td>Annotatiestatus . Status<br>*Zie bijlage B voor lijst met geadviseerde statussen voor aangesloten basisregistraties. Het is toegestaan om in de eigen catalogus afwijkende statussen op te  nemen)</td>
<td>[1..1]</td>
</tr>
<tr>
<td>---------------------------------------------------------</td>
<td>-----------</td>
</tr>
<tr>
<td><strong>Annotatie . Referentiekenmerk</strong><br><em>Eigen kenmerk terugmeldende organisatie (het mogen er meer zijn, in de huidige praktijk altijd precies één).</em></td>
<td>[1 *]</td>
</tr>
<tr>
<td><strong>Referentiekenmerk.Annotatiebasis</strong></td>
<td></td>
</tr>
<tr>
<td>Referentiekenmerk.Kenmerk<br><em>Eigen kenmerk terugmeldende organisatie.</em></td>
<td>[1..1]</td>
</tr>
<tr>
<td>---------------------------------------------------------</td>
<td>-----------</td>
</tr>
<tr>
<td><strong>Annotatie . Contactinformatie</strong><br><em>Contactgegevens.</em></td>
<td>[1 *]</td>
</tr>
<tr>
<td>Contactinformatie . @ContactType<br><em>kan alleen de waarden 'Melder' of 'Behandelaar' hebben</em></td>
<td>[1..1]</td>
</tr>
<tr>
<td><strong>Contactinformatie . Annotatiebasis</strong></td>
<td></td>
</tr>
<tr>
<td>Contactinformatie . Naam</td>
<td>[1..1]</td>
</tr>
<tr>
<td>Contactinformatie . Telefoon</td>
<td>[0..1]</td>
</tr>
<tr>
<td>Contactinformatie . Email</td>
<td>[1..1]</td>
</tr>
<tr>
<td>Contactinformatie . Afdeling</td>
<td>[0..1]</td>
</tr>
<tr>
<td>---------------------------------------------------------</td>
<td>-----------</td>
</tr>
<tr>
<td><strong>Annotatie . Bijlageverwijzing</strong><br><em>Metainformatie over bijlagen.</em><br><em>Wordt in de praktijk niet ondersteund door BRP, HR ondersteunt er maximaal 5.</em></td>
<td>[0..*]</td>
</tr>
<tr>
<td>Bijlageverwijzing . <strong>Annotatiebasis</strong></td>
<td></td>
</tr>
<tr>
<td>Bijlageverwijzing . Bestandsnaam<br><em>De naam van het bestand.</em></td>
<td>[1..1]</td>
</tr>
<tr>
<td>Bijlageverwijzing . MIMEType<br><em>Het MIME type van de bijlage.</em></td>
<td>[1..1]</td>
</tr>
<tr>
<td>Bijlageverwijzing . BijlageData<br>*Het bestand zelf in Base64-binary encoding.[^2]</td>
<td>[1..1]</td>
</tr>
<tr>
<td>Bijlageverwijzing . Beschrijving<br>*Beschrijving van de bijlage. De bijlage zelf wordt nooit mee teruggeleverd bij het bevragen van een terugmelding/annotatie.</td>
<td>[0..1]</td>
</tr>
<tr>
<td>---------------------------------------------------------</td>
<td>-----------</td>
</tr>
<tr>
<td><strong>Annotatie . Planningsverwachting</strong><br><em>Verwachte termijn voor behandeling, wordt alleen gebruikt door BRP en komt dan slechts eenmaal voor.</em></td>
<td>[0..*]</td>
</tr>
<tr>
<td>Planningsverwachting . <strong>Annotatiebasis</strong></td>
<td></td>
</tr>
<tr>
<td>Planningsverwachting . MijlpaalAanduiding<br><em>Beschrijving van de planningsverwachting.</em></td>
<td>[0..1]</td>
</tr>
<tr>
<td>Planningsverwachting . MijlpaalTijdstempel<br><em>Datum waarop de planning gereed is.</em></td>
<td>[0..1]</td>
</tr>
<tr>
<td>---------------------------------------------------------</td>
<td>-----------</td>
</tr>
<tr>
<td><strong>Annotatie . BehandelendeBronhouder</strong><br><em>Behandelende bronhouder, huidige behandelaar is leaf annotatie met meest recente tijdstempel.</em></td>
<td>[0 *]</td>
</tr>
<tr>
<td>BehandelendeBronhouder . <strong>Annotatiebasis</strong></td>
<td></td>
</tr>
<tr>
<td>BehandelendeBronhouder . Bronhouder<br><em>De bronhouder die de terugmelding momenteel in behandeling heeft.</em></td>
<td>[1..1]</td>
</tr>
</tbody></table><p>[^2]: Dit veld wordt bij een bericht 'DetailsTerugmeldingResponse' leeg gelaten</p></section></section><section id="echo"><h3 id="x5-4-echo"><bdi class="secno">5.4 </bdi>Echo<a class="self-link" href="#echo" aria-label="Permalink for Section 5.4"></a></h3><p>De berichten beschreven in deze uitwisseling kunnen worden gebruikt om
te controleren of de berichtverwerking in zijn algemeenheid beschikbaar
is.</p><section id="algemeen-1"><h4 id="x5-4-1-algemeen"><bdi class="secno">5.4.1 </bdi>Algemeen<a class="self-link" href="#algemeen-1" aria-label="Permalink for Section 5.4.1"></a></h4><table class="simple">
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>Doel</td>
<td>Het ontvangen van een antwoordbericht waaruit blijkt dat de berichtverwerking conform specificaties werkt.</td>
</tr>
<tr>
<td>Voorwaarde</td>
<td>Geen.</td>
</tr>
<tr>
<td>Trigger</td>
<td>Behoefte om te controleren of berichtverwerking naar behoren functioneert.</td>
</tr>
<tr>
<td>Direct gevolg</td>
<td>Terugsturen van een echobericht.</td>
</tr>
<tr>
<td>Vervolgactie</td>
<td>Indien de echo faalt onderzoeken waardoor dit wordt veroorzaakt.</td>
</tr>
<tr>
<td>Bijzonderheden</td>
<td></td>
</tr>
</tbody></table><p><figure id="fig-interactiediagram-voor-echo-s"><img src="images/image10.png" alt=" Interactiediagram voor echo's" title=" Interactiediagram voor echo's"><figcaption>Figuur <bdi class="figno">10</bdi> <span class="fig-title"> Interactiediagram voor echo's</span></figcaption></figure></p><p><figure id="fig-interactiediagram-echoverzoek-via-digimelding-webservice"><img src="images/image11.png" alt="Interactiediagram echoverzoek via Digimelding Webservice" title="Interactiediagram echoverzoek via Digimelding Webservice"><figcaption>Figuur <bdi class="figno">11</bdi> <span class="fig-title">Interactiediagram echoverzoek via Digimelding Webservice</span></figcaption></figure></p></section><section id="echorequest"><h4 id="x5-4-2-echorequest"><bdi class="secno">5.4.2 </bdi>EchoRequest<a class="self-link" href="#echorequest" aria-label="Permalink for Section 5.4.2"></a></h4><p>De structuur van het echoverzoek is als volgt:</p><table class="simple">
<thead>
<tr>
<th><strong>Berichttype: EchoRequest</strong></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>EchoRequest . OinBasisregistratie<br>*Het OIN van de basisregistratie waar het echoverzoek</td>
<td></td>
</tr>
<tr>
<td>naar toe moet*</td>
<td>[1..1]</td>
</tr>
<tr>
<td>EchoRequest .OinBasisregistratie<br>Het OIN van de houder van een landelijke voorziening van de basisregistratie</td>
<td>[1..1]</td>
</tr>
<tr>
<td>EchoRequest . Registratie<br>Code (maximaal 3 letterig) waarmee de basisregistratie wordt aangeduid wanneer de houder van een landelijke voorziening meer dan 1 basisregistratie beheert (bv BRT, BGT).</td>
<td>[0..1]</td>
</tr>
<tr>
<td>EchoRequest . Echo<br>De string die geëchood moet worden</td>
<td>[1..1]</td>
</tr>
</tbody></table></section><section id="echoresponse"><h4 id="x5-4-3-echoresponse"><bdi class="secno">5.4.3 </bdi>EchoResponse<a class="self-link" href="#echoresponse" aria-label="Permalink for Section 5.4.3"></a></h4><p>De structuur van het echo-antwoord is als volgt:</p><table class="simple">
<thead>
<tr>
<th><strong>Berichttype: EchoResponse</strong></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>EchoResponse . Echo<br>De teruggestuurde echo string</td>
<td>[1..1]</td>
</tr>
</tbody></table></section></section></section>
  <section data-format="markdown" id="foutberichten"><h2 id="x6-foutberichten"><bdi class="secno">6. </bdi>Foutberichten<a class="self-link" href="#foutberichten" aria-label="Permalink for Section 6."></a></h2><p>|-------------------|---------------------------------------------------------|
|  Doel             | Aangeven dat er een fout is opgetreden.                 |
|  Voorwaarde       | Een foutbericht is altijd een reactie op een reeds verzonden bericht, dus één van de vraagberichten uit de voorgaande secties (AnnotatieToevoegenRequest, StatusoverzichtRequest, DetailsTerugmeldingRequest). |
|  Trigger          | Het verzonden vraagbericht leidt tot een fout in de verwerking ervan. |
|  Direct gevolg    | Een foutbericht wordt verstuurd. |
|  Vervolgactie     | De ontvanger van het foutbericht dient de fout af te handelen. |
|  Bijzonderheden   |                                  |</p><p>Een aantal foutsituaties is voorstelbaar. Er kan een probleem zijn met
autorisatie, met de syntax van de gegevens of er kan een fout optreden
in het systeem dat de annotatie moet verwerken.</p><section id="autorisatiefouten"><h3 id="x6-1-autorisatiefouten"><bdi class="secno">6.1 </bdi>Autorisatiefouten<a class="self-link" href="#autorisatiefouten" aria-label="Permalink for Section 6.1"></a></h3><p>Wanneer een systeem van de afnemer op transportniveau of
applicatieniveau niet geautoriseerd is bij het leverende systeem dan
krijgt deze een Digikoppeling-foutmelding 'niet geautoriseerd' terug.</p><p>Optioneel kan de basisregistratie in de SOAP Fault-detail meer
informatie verstrekken.<br>Indien een basisregistratie een eigen specifiekere foutcode heeft dan
mag deze ook verzonden worden in plaats van de Digikoppeling-melding.</p></section><section id="verwerkingsfouten"><h3 id="x6-2-verwerkingsfouten"><bdi class="secno">6.2 </bdi>Verwerkingsfouten<a class="self-link" href="#verwerkingsfouten" aria-label="Permalink for Section 6.2"></a></h3><p>In het geval dat een verwerkingsfout er toe leidt dat een antwoord
volledig uitblijft, bijvoorbeeld door het offline zijn van het
verwerkende systeem, dan zal de Digikoppeling-adapter van de afnemer een
time-out geven.</p><p>Indien het bevraagde systeem het bericht niet kan verwerken door een
systeemfout maar nog wel kan antwoorden, dan krijgt de afnemer een SOAP
Fault-bericht terug met de Digikoppeling-fout DK0051 (time-out),
optioneel kan de basisregistratie in de SOAP Fault-detail meer
informatie verstrekken. Wanneer het bericht niet verwerkt kan worden
vanwege een probleem met de inhoud van het bericht, anders dan de
syntax, dan wordt een DK0050-bericht ('kan bericht niet verwerken')
verstuurd. Indien een basisregistratie een eigen specifieke foutcode
heeft dan mag deze in plaats van de Digikoppeling-foutmelding verstuurd
worden.</p></section><section id="syntaxfouten"><h3 id="x6-3-syntaxfouten"><bdi class="secno">6.3 </bdi>Syntaxfouten<a class="self-link" href="#syntaxfouten" aria-label="Permalink for Section 6.3"></a></h3><p>Indien er een syntaxfout zit in de Digikoppeling-headers, dan volgt
hierop een SOAP Fault met de juiste foutcode volgens de
Digikoppelingstandaard (er bestaan specifieke foutcodes voor fouten in
headervelden).</p><p>Indien de inhoud van het vraagbericht niet voldoet aan de syntax van het
vraagbericht-XSD of een andere XSD die over de inhoud van het bericht
gaat dan wordt een SOAP Fault verstuurd; deze heeft als code DK0004
('element niet conform XSD'). In de SOAP Fault-detail wordt door de
basisregistratie aangegeven tegen welke XSD het bericht niet valideerde.
Optioneel is de basisregistratie vrij om nog meer informatie mee te
geven in de toelichting. Indien een basisregistratie een eigen
specifieke foutcode heeft dan mag deze in plaats van de
Digikoppeling-foutcode verstuurd worden.</p><p>Synchrone fouten voor Digikoppeling-WUS-berichten worden verstuurd als
SOAP Fault zoals dit is voorgesteld voor de berichtenstandaard van het
stelsel.[^4] SOAP Faults worden doorgaans door de Digikoppeling-adapter
doorgestuurd naar de achterliggende applicatie. Dit koppelvlak gaat er
vanuit dat dit ook gebeurt voor de fouten die hier beschreven worden. De
foutafhandeling dient in de terugmeldapplicatie plaats te vinden. Binnen
de SOAP Fault wordt een aantal velden onderkend te weten:</p><p>+---------------------------------------------------------+-----------+
| <strong>Berichttype</strong>: DigimeldingSynchroonFault              |           |
|                                                         |           |
| <em>Synchrone foutafhandeling gaat middels een SOAP Fault</em> |           |
+=========================================================+===========+
|                                                         |           |
+---------------------------------------------------------+-----------+
| faultcode                                               | [1..1]  |
|                                                         |           |
| <em>De plek waar de fout is opgetreden, één string         |           |
| opgebouwd uit de elementen                              |           |
| &lt;defaultwaarde&gt;.&lt;code&gt;.&lt;omschrijvingkort&gt; :</em>      |           |
|                                                         |           |
| Defaultwaarde\                                          |           |
| <em>Bevat één van de defaultwaarden VersionMismatch,       |           |
| MustUnderstand, Client en Server.</em>[^6] <em>Voor            |           |
| Digimeldingpraktijk zijn alleen Client- of              |           |
| Server-waarden relevant om aan te geven wat de aard van |           |
| de fout is.</em>                                            |           |
|                                                         |           |
| Code\                                                   |           |
| <em>De specifieke foutcode die hoort bij de technische     |           |
| fout (format: &lt;afkortingbron&gt;&lt;codering van="" fout=""&gt;.</em>  |           |
|                                                         |           |
| OmschrijvingKort <em>\                                     |           |
| De korte omschrijving van de fout (bijvoorbeeld: de     |           |
| Digikoppeling omschrijving uit de lijst met             |           |
| foutmeldingen.</em>                                         |           |
|                                                         |           |
| Voorbeeld:&lt;soap:fault&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;             |           |
| &lt;fa |="" ultcode=""&gt;<em>soap:Server</em>&amp;nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |           |
| \                                                       |           |
| &lt;faultstring&gt;<em>Fout</em>&lt;/faultstring&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |           |
| &lt;detail&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        |           |
| **&lt;digimeldingsynchroonfault** |="" xmlns="&amp;quot;h" ttp:="" webservices.digimelding.nl="" dmks="" cookiebox="" "=""&gt;&nbsp;&nbsp;&nbsp; |           |
| &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |           |
| &lt;faultcode&gt;<em>001</em>&lt;/faultcode&gt;&nbsp;&nbsp;&nbsp;                     |           |
| &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |           |
| &lt;faultstring&gt;<em>Foutmelding</em>                            |           |
| &lt;/faultstring&gt;&nbsp;&nbsp;&nbsp;                                     |           |
| &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |           |
| &lt;faultactor&gt;<em>Actor</em>&lt;/faultactor&gt;&nbsp;&nbsp;&nbsp;                 |           |
| &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |           |
| &lt;faultdetail =""&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  |           |
| *<em>*</em>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   |           |
| &lt;/faultdetail&gt;&lt;/digimeldingsynchroonfault**&gt;&lt;/detail&gt;&lt;/fa&gt;&lt;/soap:fault&gt;                              |           |
+---------------------------------------------------------+-----------+
| faultstring                                             | [1..1]  |
|                                                         |           |
| <em>De eigen meer gedetailleerde beschrijving van de       |           |
| foutsituatie.</em>                                          |           |
|                                                         |           |
| <em>De eigen beschrijving zoveel mogelijk geschikt maken   |           |
| voor het kunnen presenteren aan gebruiker.</em>             |           |
|                                                         |           |
| <em>De ontvanger is niet verplicht deze tekst over te      |           |
| nemen.</em>                                                 |           |
+---------------------------------------------------------+-----------+
| faultactor                                              | [0..*] |
|                                                         |           |
| <em>Bevat een URI van de antwoordende service.</em>            |           |
|                                                         |           |
| <em>Vul de faultactor in met de URI van de bron van de     |           |
| oorzaak, indien het SOAP-bericht langs een              |           |
| tussenstation gaat. Bijvoorbeeld Digimelding            |           |
| Webservice.</em>                                            |           |
+---------------------------------------------------------+-----------+
| faultdetail                                             | [0..*] |
|                                                         |           |
| <em>Volledig vrij veld om nadere toelichting op de fout te |           |
| geven, kan gebruikt worden om bijv. achterliggende      |           |
| applicatiefoutmeldingen mee te geven (xs:any).</em>         |           |
+---------------------------------------------------------+-----------+</p><p>Voorbeeld:</p><blockquote>
<p>&lt;soap:fault&gt;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;faultcode&gt;<em>soap:Server</em>&lt;/faultcode&gt;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;faultstring&gt;<em>Fout</em>&lt;/faultstring&gt;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;detail&gt;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; **&lt;digimeldingsynchroonfault**&gt; xmlns="&lt;http: webservices.digimelding.nl="" dmks="" cookiebox=""&gt;"&gt;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&lt;faultcode&gt;<em>001</em>&lt;/faultcode&gt;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&lt;faultstring&gt;<em>Foutmelding</em> &lt;/faultstring&gt;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&lt;faultactor&gt;<em>Actor</em>&lt;/faultactor&gt;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&lt;faultdetail =""&gt;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
*<em>*</em></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/faultdetail&gt;&lt;/digimeldingsynchroonfault**&gt;&lt;/detail&gt;</p>
<p>&lt;/soap:fault&gt;</p>
</blockquote></section><section id="generieke-foutcodes-van-toepassing-op-digimelding"><h3 id="x6-4-generieke-foutcodes-van-toepassing-op-digimelding"><bdi class="secno">6.4 </bdi>Generieke foutcodes van toepassing op Digimelding<a class="self-link" href="#generieke-foutcodes-van-toepassing-op-digimelding" aria-label="Permalink for Section 6.4"></a></h3><p>Voor fouten op protocolniveau dienen de fouten van Digikoppeling gevolgd
te worden. Voor generieke fouten in Digimelding zijn de volgende
Digikoppeling-foutcodes van toepassing:</p><table class="simple">
<thead>
<tr>
<th><strong>Nr</strong></th>
<th><strong>Omschrijving</strong></th>
<th><strong>Toelichting</strong></th>
</tr>
</thead>
<tbody><tr>
<td>DK0002</td>
<td>Requester systeem niet geautoriseerd</td>
<td>Indien je voor een basisregistratie niet geautoriseerd bent, ontvang je geen inhoudelijke informatie van die basisregistratie. Het autorisatiemodel wordt door de basisregistratie bepaald. In de foutmelding wordt de betreffende basisregistratie, waarvoor geen autorisatie bestaat, teruggegeven.</td>
</tr>
<tr>
<td>DK0004</td>
<td>Element niet conform XSD</td>
<td>Bij een validatiefout wordt meegegeven in het SOAP Faultdetail aan welke XSD niet voldaan wordt.</td>
</tr>
<tr>
<td>DK0050</td>
<td>Proces voor afhandelen bericht geeft fout</td>
<td>Wanneer een bericht zich niet houdt aan afspraken die gemaakt zijn rondom de vulling van de payload welke basisregistratiespecifiek zijn, bijvoorbeeld: Status is volgens de XSD een vrij tekstveld, iedere basisregistratie is vrij deze te kiezen. De basisregistratie kan teruggeven dat een status bij hen niet bekend is.</td>
</tr>
<tr>
<td>DK0051</td>
<td>Antwoordend systeem geeft time-out</td>
<td>Indien de achterliggende applicatie niet draait of een fout produceert dan kan het geen antwoord geven terwijl een geldig antwoord wel mogelijk zou moeten zijn en de messaging stack(Digikoppeling) nog wel in de lucht is.</td>
</tr>
<tr>
<td>&lt;/afkortingbron&gt;&lt;/omschrijvingkort&gt;&lt;/code&gt;&lt;/defaultwaarde&gt;</td>
<td></td>
<td></td>
</tr>
</tbody></table></section></section>
  <section data-format="markdown" id="bijlagen"><h2 id="x7-bijlagen"><bdi class="secno">7. </bdi>bijlagen<a class="self-link" href="#bijlagen" aria-label="Permalink for Section 7."></a></h2><section id="bijlage-a-afkortingen-begrippen-en-symbolen-bijlage-a-afkortingen-begrippen-en-symbolen-list-paragraph"><h3 id="x7-1-bijlage-a-afkortingen-begrippen-en-symbolen-bijlage-a-afkortingen-begrippen-en-symbolen-list-paragraph"><bdi class="secno">7.1 </bdi>Bijlage A: Afkortingen, begrippen en symbolen {#bijlage-a-afkortingen-begrippen-en-symbolen .list-paragraph}<a class="self-link" href="#bijlage-a-afkortingen-begrippen-en-symbolen-bijlage-a-afkortingen-begrippen-en-symbolen-list-paragraph" aria-label="Permalink for Section 7.1"></a></h3><p>  <strong>Afkorting</strong>   <strong>Omschrijving</strong></p><hr><p>  BAG             Basisregistratie Adressen en Gebouwen
  BRP             Basisregistratie Personen
  GEMMA           Gemeentelijke modelarchitectuur
  ICTU            ICT Uitvoeringsorganisatie
  KING            Kwaliteitsinstituut Nederlandse Gemeenten
  HR              Handelsregister
  NUP             Nationaal Uitvoeringsprogramma
  StUF            Standaarduitwisselingsformaat</p><p>**<br>**</p></section><section id="bijlage-b-geadviseerde-statussen-bijlage-b-geadviseerde-statussen-list-paragraph"><h3 id="x7-2-bijlage-b-geadviseerde-statussen-bijlage-b-geadviseerde-statussen-list-paragraph"><bdi class="secno">7.2 </bdi>Bijlage B : Geadviseerde Statussen {#bijlage-b-geadviseerde-statussen .list-paragraph}<a class="self-link" href="#bijlage-b-geadviseerde-statussen-bijlage-b-geadviseerde-statussen-list-paragraph" aria-label="Permalink for Section 7.2"></a></h3><p><em>Diagram</em></p><p>Op een terugmelding kunnen verschillende statussen van toepassing zijn.
In onderstaand figuur zijn de verschillende statussen en hun relatie
afgebeeld.</p><p><em>Definities</em></p><p>  naar                     <em>geen</em>   Gemeld   In behandeling   Ingetrokken   Onvoldoende informatie   Verkeerde Bronhouder   Ingepland   Afgehandeld   </p><hr><p>  van                      &nbsp;        &nbsp;        &nbsp;                &nbsp;             &nbsp;                        &nbsp;                      &nbsp;           &nbsp;<br>  <em>Geen</em>                   &nbsp;        x        &nbsp;                &nbsp;             &nbsp;                        &nbsp;                      &nbsp;           &nbsp;<br>  Gemeld                   &nbsp;        &nbsp;        x                x             x                        x                      &nbsp;           &nbsp;<br>  In behandeling           &nbsp;        &nbsp;        &nbsp;                x             &nbsp;                        &nbsp;                      x           x<br>  Ingetrokken              &nbsp;        &nbsp;        &nbsp;                &nbsp;             &nbsp;                        &nbsp;                      &nbsp;           &nbsp;<br>  Onvoldoende informatie   &nbsp;        &nbsp;        &nbsp;                &nbsp;             &nbsp;                        &nbsp;                      &nbsp;           &nbsp;<br>  Verkeerde Bronhouder     &nbsp;        x        &nbsp;                x             &nbsp;                        &nbsp;x                     &nbsp;           &nbsp;<br>  Ingepland                &nbsp;        &nbsp;        &nbsp;                &nbsp;             &nbsp;                        &nbsp;                      &nbsp;           x<br>  Afgehandeld              &nbsp;        &nbsp;        &nbsp;                &nbsp;             &nbsp;                        &nbsp;                      &nbsp;           &nbsp;             </p><p>  Eindstatus               &nbsp;<br>  overgang mogelijk        X                                                                                                                          </p><p>[^3]: Best Effort, beveiligd met tweezijdige TLS en gesigneerde
    berichten</p><p>[^4]: Zie voorstel "foutafhandeling synchrone berichten" van de
    "gemeenschappelijke afspraken berichtstandaarden"
    &lt;https: digistandaarden.pleio.nl="" groups="" profile="" 24027452="" gemeenschappelijke-afspraken-berichtstandaarden-gab=""&gt;</p><p>[^5]: Zie &lt;http: <a href="http://www.w3.org=&quot;&quot;">www.w3.org=""</a> tr="" 2000="" note-soap-20000508=""&gt; sectie 4.4.1
    voor uitleg</p><p>[^6]: Zie &lt;http: <a href="http://www.w3.org=&quot;&quot;">www.w3.org=""</a> tr="" 2000="" note-soap-20000508=""&gt; sectie 4.4.1
    voor uitleg
</p></section></section>



<p role="navigation" id="back-to-top">
    <a href="#title"><abbr title="Back to Top">↑</abbr></a>
  </p><script id="respec-dfn-panel">(() => {
// @ts-check
if (document.respec) {
  document.respec.ready.then(setupPanel);
} else {
  setupPanel();
}

function setupPanel() {
  const listener = panelListener();
  document.body.addEventListener("keydown", listener);
  document.body.addEventListener("click", listener);
}

function panelListener() {
  /** @type {HTMLElement} */
  let panel = null;
  return event => {
    const { target, type } = event;

    if (!(target instanceof HTMLElement)) return;

    // For keys, we only care about Enter key to activate the panel
    // otherwise it's activated via a click.
    if (type === "keydown" && event.key !== "Enter") return;

    const action = deriveAction(event);

    switch (action) {
      case "show": {
        hidePanel(panel);
        /** @type {HTMLElement} */
        const dfn = target.closest("dfn, .index-term");
        panel = document.getElementById(`dfn-panel-for-${dfn.id}`);
        const coords = deriveCoordinates(event);
        displayPanel(dfn, panel, coords);
        break;
      }
      case "dock": {
        panel.style.left = null;
        panel.style.top = null;
        panel.classList.add("docked");
        break;
      }
      case "hide": {
        hidePanel(panel);
        panel = null;
        break;
      }
    }
  };
}

/**
 * @param {MouseEvent|KeyboardEvent} event
 */
function deriveCoordinates(event) {
  const target = /** @type HTMLElement */ (event.target);

  // We prevent synthetic AT clicks from putting
  // the dialog in a weird place. The AT events sometimes
  // lack coordinates, so they have clientX/Y = 0
  const rect = target.getBoundingClientRect();
  if (
    event instanceof MouseEvent &&
    event.clientX >= rect.left &&
    event.clientY >= rect.top
  ) {
    // The event probably happened inside the bounding rect...
    return { x: event.clientX, y: event.clientY };
  }

  // Offset to the middle of the element
  const x = rect.x + rect.width / 2;
  // Placed at the bottom of the element
  const y = rect.y + rect.height;
  return { x, y };
}

/**
 * @param {Event} event
 */
function deriveAction(event) {
  const target = /** @type {HTMLElement} */ (event.target);
  const hitALink = !!target.closest("a");
  if (target.closest("dfn:not([data-cite]), .index-term")) {
    return hitALink ? "none" : "show";
  }
  if (target.closest(".dfn-panel")) {
    if (hitALink) {
      return target.classList.contains("self-link") ? "hide" : "dock";
    }
    const panel = target.closest(".dfn-panel");
    return panel.classList.contains("docked") ? "hide" : "none";
  }
  if (document.querySelector(".dfn-panel:not([hidden])")) {
    return "hide";
  }
  return "none";
}

/**
 * @param {HTMLElement} dfn
 * @param {HTMLElement} panel
 * @param {{ x: number, y: number }} clickPosition
 */
function displayPanel(dfn, panel, { x, y }) {
  panel.hidden = false;
  // distance (px) between edge of panel and the pointing triangle (caret)
  const MARGIN = 20;

  const dfnRects = dfn.getClientRects();
  // Find the `top` offset when the `dfn` can be spread across multiple lines
  let closestTop = 0;
  let minDiff = Infinity;
  for (const rect of dfnRects) {
    const { top, bottom } = rect;
    const diffFromClickY = Math.abs((top + bottom) / 2 - y);
    if (diffFromClickY < minDiff) {
      minDiff = diffFromClickY;
      closestTop = top;
    }
  }

  const top = window.scrollY + closestTop + dfnRects[0].height;
  const left = x - MARGIN;
  panel.style.left = `${left}px`;
  panel.style.top = `${top}px`;

  // Find if the panel is flowing out of the window
  const panelRect = panel.getBoundingClientRect();
  const SCREEN_WIDTH = Math.min(window.innerWidth, window.screen.width);
  if (panelRect.right > SCREEN_WIDTH) {
    const newLeft = Math.max(MARGIN, x + MARGIN - panelRect.width);
    const newCaretOffset = left - newLeft;
    panel.style.left = `${newLeft}px`;
    /** @type {HTMLElement} */
    const caret = panel.querySelector(".caret");
    caret.style.left = `${newCaretOffset}px`;
  }

  // As it's a dialog, we trap focus.
  // TODO: when <dialog> becomes a implemented, we should really
  // use that.
  trapFocus(panel, dfn);
}

/**
 * @param {HTMLElement} panel
 * @param {HTMLElement} dfn
 * @returns
 */
function trapFocus(panel, dfn) {
  /** @type NodeListOf<HTMLAnchorElement> elements */
  const anchors = panel.querySelectorAll("a[href]");
  // No need to trap focus
  if (!anchors.length) return;

  // Move focus to first anchor element
  const first = anchors.item(0);
  first.focus();

  const trapListener = createTrapListener(anchors, panel, dfn);
  panel.addEventListener("keydown", trapListener);

  // Hiding the panel releases the trap
  const mo = new MutationObserver(records => {
    const [record] = records;
    const target = /** @type HTMLElement */ (record.target);
    if (target.hidden) {
      panel.removeEventListener("keydown", trapListener);
      mo.disconnect();
    }
  });
  mo.observe(panel, { attributes: true, attributeFilter: ["hidden"] });
}

/**
 *
 * @param {NodeListOf<HTMLAnchorElement>} anchors
 * @param {HTMLElement} panel
 * @param {HTMLElement} dfn
 * @returns
 */
function createTrapListener(anchors, panel, dfn) {
  const lastIndex = anchors.length - 1;
  let currentIndex = 0;
  return event => {
    switch (event.key) {
      // Hitting "Tab" traps us in a nice loop around elements.
      case "Tab": {
        event.preventDefault();
        currentIndex += event.shiftKey ? -1 : +1;
        if (currentIndex < 0) {
          currentIndex = lastIndex;
        } else if (currentIndex > lastIndex) {
          currentIndex = 0;
        }
        anchors.item(currentIndex).focus();
        break;
      }

      // Hitting "Enter" on an anchor releases the trap.
      case "Enter":
        hidePanel(panel);
        break;

      // Hitting "Escape" returns focus to dfn.
      case "Escape":
        hidePanel(panel);
        dfn.focus();
        return;
    }
  };
}

/** @param {HTMLElement} panel */
function hidePanel(panel) {
  if (!panel) return;
  panel.hidden = true;
  panel.classList.remove("docked");
}
})()</script><script src="https://www.w3.org/scripts/TR/2021/fixup.js"></script></body></html>